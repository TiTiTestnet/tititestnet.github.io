(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[7308],{11523:(P,f,i)=>{"use strict";i.d(f,{o:()=>t});var a=i(17489),n=i(5e3),h=i(48966);const e=["chart"];let t=(()=>{class s{constructor(p,l){this.dialog=p,this.ngZone=l,this.showTitle=!1}ngOnInit(){}ngAfterViewInit(){this.refreshChart()}ngOnChanges(p){this.refreshChart()}refreshChart(){this.option&&0!==Object.keys(this.option).length&&this.option.series&&this.option.series[0]&&0!==this.option.series[0].data.length&&i.e(8045).then(i.bind(i,28045)).then(p=>{this.ngZone.runOutsideAngular(()=>{this.echartsInstance||(this.echartsInstance=p.init(this.chartDivRef.nativeElement));let l=Object.assign({},(0,a.cloneDeep)(this.option),{});l.yAxis&&l.yAxis[0]&&(l.yAxis[0].axisLabel={show:!1}),l.xAxis&&l.xAxis[0]&&(l.xAxis[0].axisLabel={show:!1}),l.title&&(l.title.show=this.showTitle,l.title.textStyle.fontSize=21,l.title.textStyle.fontWeight=500),this.echartsInstance.setOption(l),this.dialogRef&&this.dialogRef.componentInstance&&this.dialogRef.componentInstance.echartsInstance&&this.dialogRef.componentInstance.echartsInstance.setOption(this.option)})})}showChartModal(){Promise.all([i.e(8045),i.e(5532)]).then(i.bind(i,75532)).then(({ChartModalComponent:p})=>{this.dialogRef=this.dialog.open(p,{width:"80vw"}),this.dialogRef.componentInstance.option=this.option,this.dialogRef.afterClosed().subscribe()})}}return s.\u0275fac=function(p){return new(p||s)(n.Y36(h.uw),n.Y36(n.R0b))},s.\u0275cmp=n.Xpm({type:s,selectors:[["titi-chart-wrapper"]],viewQuery:function(p,l){if(1&p&&n.Gf(e,5),2&p){let y;n.iGM(y=n.CRH())&&(l.chartDivRef=y.first)}},inputs:{showTitle:"showTitle",option:"option"},features:[n.TTD],decls:4,vars:0,consts:[[2,"width","100%","height","100%","cursor","pointer","display","grid",3,"click"],["modal",""],[2,"width","100%","height","100%","min-height","150px"],["chart",""]],template:function(p,l){1&p&&(n.TgZ(0,"div",0,1),n.NdJ("click",function(){return l.showChartModal()}),n._UZ(2,"div",2,3),n.qZA())},styles:[""]}),s})()},45922:(P,f,i)=>{"use strict";i.d(f,{F:()=>e});var a=i(69808),d=i(48966),n=i(87841),h=i(5e3);let e=(()=>{class t{}return t.\u0275fac=function(g){return new(g||t)},t.\u0275mod=h.oAB({type:t}),t.\u0275inj=h.cJS({imports:[[a.ez,d.Is,n.m]]}),t})()},92134:(P,f,i)=>{"use strict";i.d(f,{Q:()=>h});var a=i(5e3),d=i(87238),n=i(63874);let h=(()=>{class e{constructor(){this.color="warn",this.text="",this.position="after"}ngOnInit(){}}return e.\u0275fac=function(s){return new(s||e)},e.\u0275cmp=a.Xpm({type:e,selectors:[["titi-tooltip"]],inputs:{color:"color",text:"text",position:"position"},decls:4,vars:4,consts:[["matTooltipHideDelay","200",1,"tooltip-highlight",2,"margin-left","2px",3,"matTooltip","matTooltipPosition","matTooltipClass"],["tooltip","matTooltip"],[2,"font-size","18px","line-height","24px","display","inline","vertical-align","middle",3,"color"]],template:function(s,g){1&s&&(a.TgZ(0,"span",0,1),a.TgZ(2,"mat-icon",2),a._uU(3," help_outline "),a.qZA(),a.qZA()),2&s&&(a.Q6J("matTooltip",g.text)("matTooltipPosition",g.position)("matTooltipClass","titi-tooltip-text"),a.xp6(2),a.Q6J("color",g.color))},directives:[d.gM,n.Hw],styles:[""]}),e})()},57308:(P,f,i)=>{"use strict";i.r(f),i.d(f,{TitiModule:()=>w});var a=i(69808),d=i(71787),n=i(17489),h=i(28321),e=i(11730),t=i(5e3),s=i(65707),g=i(53405),p=i(74696),l=i(31657),y=i(92134),S=i(47423),M=i(11523),O=i(75303);const A=[{path:"",component:(()=>{class c{constructor(o,r,T,D,m){this.chainInfoService=o,this.graphService=r,this.echartService=T,this.web3Service=D,this.refreshService=m,this.totalStakedTiTi=0,this.totalTiTiSupply=0,this.titiDailyPrice=[0],this.TiUSDDailyPrice=[],this.option={}}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){Promise.all([this.fetchTiUSDChartData(),this.fetchCurrentEpochInfo(),this.fetchTiTiTotalSupply(),this.fetchOptions()]).then(()=>this.buildOption())}buildOption(){this.option.series[0].data=this.titiDailyPrice,this.option=(0,n.cloneDeep)(this.option)}fetchOptions(){return this.echartService.fetchOption("TiTi-Price").then(o=>this.option=o)}fetchTiUSDChartData(){return this.graphService.fetchMMFSwapPairDailyData(this.chainInfoService.getChainConfig().contractAddressMap.MAMMSwapPair).then(({data:o})=>{var r;this.TiUSDDailyPrice=Array(30).fill(null);const T=(0,h.Gq)().reverse();null===(r=o.pair)||void 0===r||r.pairDailyData.forEach(m=>{const u=T.indexOf(1e3*m.dayStartTimestamp);-1!==u&&(this.TiUSDDailyPrice[u]=m.token0Price)});let D=1;return this.TiUSDDailyPrice.forEach((m,u)=>{null==m?this.TiUSDDailyPrice[u]=D:D=m}),this.fetchUniwapPairDailyData()})}fetchUniwapPairDailyData(){return Promise.all([this.graphService.fetchUniwapPairDailyData(),this.web3Service.invokeContract("UniswapV2Pair","getReserves",[])]).then(([{data:o},r])=>{const T=Array(30).fill(null),D=(0,h.Gq)().reverse();0===o.uniswapPair.dailyData.length?T.fill(r[1]/r[0]):o.uniswapPair.dailyData.forEach(u=>{const v=D.indexOf(1e3*u.dayStartTimestamp);-1!==v&&(T[v]=0==u.fund0?0:u.fund1/u.fund0)});let m="0";T.forEach((u,v)=>{null==u?T[v]=m*this.TiUSDDailyPrice[v]:(T[v]=u*this.TiUSDDailyPrice[v],m=T[v])}),this.titiDailyPrice=T})}fetchCurrentEpochInfo(){return this.web3Service.invokeContract("TiTiBackendV1","epochNum",[]).then(o=>{this.fetchTiTiStakingInfoByEpoch(o[0])})}fetchTiTiStakingInfoByEpoch(o){return this.web3Service.invokeContract("TiTiStaking","totalTiTi",[]).then(r=>{this.totalStakedTiTi=r[0]/10**18})}fetchTiTiTotalSupply(){return Promise.all([this.web3Service.invokeContract("TiTiToken","totalSupply",[]),this.web3Service.invokeContract("TiTiToken","balanceOf",[this.chainInfoService.getChainConfig().contractAddressMap.MMFLPStakingPool]),this.web3Service.invokeContract("TiTiToken","balanceOf",[e.il]),this.web3Service.invokeContract("TiTiToken","balanceOf",[e.Lg]),this.web3Service.invokeContract("TiTiToken","balanceOf",[e.cr]),this.web3Service.invokeContract("TiTiToken","balanceOf",[e.Ew]),this.web3Service.invokeContract("TiTiToken","balanceOf",[e.xo]),this.web3Service.invokeContract("TiTiToken","balanceOf",[e.vl]),this.web3Service.invokeContract("TiTiToken","balanceOf",[e.Hg]),this.web3Service.invokeContract("TiTiToken","balanceOf",[e.wj]),...Object.keys(this.chainInfoService.getChainConfig().lpminingPools).map(o=>this.web3Service.invokeContract("TiTiToken","balanceOf",[o]))]).then(o=>{let r=o[0][0];for(let T=1;T<o.length;T++)r-=o[T][0];this.totalTiTiSupply=r/10**18})}}return c.\u0275fac=function(o){return new(o||c)(t.Y36(s.Z),t.Y36(g.h),t.Y36(p.p),t.Y36(e.Uc),t.Y36(l.g))},c.\u0275cmp=t.Xpm({type:c,selectors:[["app-titi"]],decls:26,vars:16,consts:[[1,"titi-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],[3,"text"],[1,"value"],["target","_blank",1,"action-btn",3,"href"],["mat-raised-button","","color","primary",2,"width","100%"],["text","Proportion of staked TiTi in total circulation"],[1,"mat-elevation-z4","chart-wrapper"],[2,"width","100%","height","100%",3,"option","showTitle"]],template:function(o,r){1&o&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3,"TiTi Price "),t._UZ(4,"titi-tooltip",3),t.qZA(),t.TgZ(5,"span",4),t._uU(6),t.ALo(7,"numberFormat"),t.qZA(),t.TgZ(8,"a",5),t.TgZ(9,"button",6),t._uU(10,"BUY"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"div",1),t.TgZ(12,"h2",2),t._uU(13,"TiTi Circulation"),t.qZA(),t.TgZ(14,"span",4),t._uU(15),t.ALo(16,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(17,"div",1),t.TgZ(18,"h2",2),t._uU(19,"Staked Ratio "),t._UZ(20,"titi-tooltip",7),t.qZA(),t.TgZ(21,"span",4),t._uU(22),t.ALo(23,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(24,"div",8),t._UZ(25,"titi-chart-wrapper",9),t.qZA(),t.qZA()),2&o&&(t.xp6(4),t.Q6J("text","TiTi price calculated based on "+r.chainInfoService.getChainConfig().swapDexName+" and MAMM"),t.xp6(2),t.hij("$",t.xi3(7,7,r.titiDailyPrice[r.titiDailyPrice.length-1],4),""),t.xp6(2),t.Q6J("href",r.chainInfoService.getChainConfig().buyTiTiUrl,t.LSH),t.xp6(7),t.Oqu(t.xi3(16,10,r.totalTiTiSupply,4)),t.xp6(7),t.hij("",0===r.totalTiTiSupply?0:t.xi3(23,13,100*r.totalStakedTiTi/r.totalTiTiSupply,4),"%"),t.xp6(3),t.Q6J("option",r.option)("showTitle",!0))},directives:[y.Q,S.lW,M.o],pipes:[O.p],styles:[".titi-wrapper[_ngcontent-%COMP%]{padding:12px 24px 24px 12px;display:grid;grid-template-columns:2fr 2fr 2fr 2fr 2fr 2fr 0fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:24px;row-gap:24px}.biz-info-card[_ngcontent-%COMP%]{min-height:80px;padding:18px;width:100%;grid-column-start:span 2;display:grid;grid-template-columns:1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 3;margin-left:48px;margin-bottom:20px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:end;font-size:18px;margin-left:48px;line-height:36px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 6;align-self:start;justify-self:start;width:100%;padding:12px 18px;height:calc(100vh - 280px)}@media screen and (max-width: 1024px){.titi-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr;width:100%;padding:12px;grid-row-gap:12px;row-gap:12px}.biz-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px;height:auto}}"]}),c})()}];let E=(()=>{class c{}return c.\u0275fac=function(o){return new(o||c)},c.\u0275mod=t.oAB({type:c}),c.\u0275inj=t.cJS({imports:[[d.Bz.forChild(A)],d.Bz]}),c})();var x=i(45922),U=i(87841);let w=(()=>{class c{}return c.\u0275fac=function(o){return new(o||c)},c.\u0275mod=t.oAB({type:c}),c.\u0275inj=t.cJS({imports:[[a.ez,E,x.F,U.m,S.ot]]}),c})()},75303:(P,f,i)=>{"use strict";i.d(f,{p:()=>d});var a=i(5e3);let d=(()=>{class n{transform(e,t){const s=Math.pow(10,t);return(Math.floor(e*s)/s).toFixed(t)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275pipe=a.Yjl({name:"numberFormat",type:n,pure:!0}),n})()},74696:(P,f,i)=>{"use strict";i.d(f,{p:()=>h});var a=i(17489),n=i(5e3);let h=(()=>{class e{constructor(){}fetchOption(s){return i(45744)(`./${s}`).then(g=>(0,a.cloneDeep)(g.default))}}return e.\u0275fac=function(s){return new(s||e)},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},45744:(P,f,i)=>{var a={"./LPMining-APY":[62790,8045,2790],"./LPMining-APY.ts":[62790,8045,2790],"./LPMining-Liquidity":[57238,8045,7238],"./LPMining-Liquidity.ts":[57238,8045,7238],"./MMF-APY":[95737,8045,5737],"./MMF-APY.ts":[95737,8045,5737],"./RainydayFund-Bar":[35201,5201],"./RainydayFund-Bar.ts":[35201,5201],"./RainydayFund-Pie":[16655,6655],"./RainydayFund-Pie.ts":[16655,6655],"./TiTi-Price":[73107,8045,3107],"./TiTi-Price.ts":[73107,8045,3107],"./TiTiStaking-APY":[33186,8045,3186],"./TiTiStaking-APY.ts":[33186,8045,3186],"./TiTiStaking-Ratio":[53297,8045,3297],"./TiTiStaking-Ratio.ts":[53297,8045,3297],"./TiUSD-Reserve-Bar":[78817,8817],"./TiUSD-Reserve-Bar.ts":[78817,8817],"./TiUSD-Reserve-Pie":[83706,3706],"./TiUSD-Reserve-Pie.ts":[83706,3706],"./TiUSD-TWAP":[34917,4917],"./TiUSD-TWAP.ts":[34917,4917],"./TiUSDPrice":[53487,8045,3487],"./TiUSDPrice.ts":[53487,8045,3487]};function d(n){if(!i.o(a,n))return Promise.resolve().then(()=>{var t=new Error("Cannot find module '"+n+"'");throw t.code="MODULE_NOT_FOUND",t});var h=a[n],e=h[0];return Promise.all(h.slice(1).map(i.e)).then(()=>i(e))}d.keys=()=>Object.keys(a),d.id=45744,P.exports=d}}]);