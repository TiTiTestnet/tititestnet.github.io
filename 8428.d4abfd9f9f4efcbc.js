"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[8428],{38428:(b,f,a)=>{a.r(f),a.d(f,{TiusdModule:()=>N});var u=a(69808),g=a(71787),d=a(17489),v=a(28321),t=a(5e3),Z=a(65707),R=a(53405),A=a(74696),U=a(11730),x=a(31657),S=a(92134),y=a(47423),C=a(11523),T=a(4834),m=a(26688),F=a(75303);function D(n,o){if(1&n&&(t.ynx(0),t.TgZ(1,"span",17),t._uU(2),t.qZA(),t.TgZ(3,"span",18),t._uU(4),t.ALo(5,"numberFormat"),t.qZA(),t.BQk()),2&n){const e=o.$implicit,i=o.index,s=t.oxw();t.xp6(2),t.hij("",e,":"),t.xp6(2),t.hij("$ ",t.xi3(5,2,s.currentReserveRatio[i],4),"")}}function O(n,o){if(1&n&&(t.ynx(0),t.TgZ(1,"span",17),t._uU(2),t.qZA(),t.TgZ(3,"span",18),t._uU(4),t.ALo(5,"numberFormat"),t.qZA(),t.BQk()),2&n){const e=o.$implicit,i=o.index,s=t.oxw();t.xp6(2),t.hij("",e,":"),t.xp6(2),t.hij("$ ",t.xi3(5,2,s.currentRainydayFundRatio[i],4),"")}}const M=[{path:"",component:(()=>{class n{constructor(e,i,s,r,l){this.chainInfoService=e,this.graphService=i,this.echartService=s,this.web3Service=r,this.refreshService=l,this.option1={},this.option2={},this.option3={},this.option4={},this.TiUSDCirculation=0,this.TiUSDPrice=1,this.reserveRatio=100,this.totalReserve=0,this.reserveNames=[],this.currentReserveRatio=[],this.dailyReserveValue=[],this.totalRainydayFund=0,this.currentRainydayFundRatio=[],this.dailyRainydayFundValue=[]}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){Promise.all([this.fetchReserves(),this.fetchOptions()]).then(()=>{this.buildOption(),this.fetchTiUSDInfo()})}buildOption(){this.option1.series=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],type:"bar",stack:"total",label:{show:!1},emphasis:{focus:"series"},data:this.dailyReserveValue[i]})),this.option3.series=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],type:"bar",stack:"total",label:{show:!1},emphasis:{focus:"series"},data:this.dailyRainydayFundValue[i]})),this.option2.series[0].data=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],value:this.currentReserveRatio[i]})),this.option4.series[0].data=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],value:this.currentRainydayFundRatio[i]})),this.option1=(0,d.cloneDeep)(this.option1),this.option2=(0,d.cloneDeep)(this.option2),this.option3=(0,d.cloneDeep)(this.option3),this.option4=(0,d.cloneDeep)(this.option4)}fetchOptions(){return Promise.all([this.echartService.fetchOption("TiUSD-Reserve-Bar"),this.echartService.fetchOption("TiUSD-Reserve-Pie"),this.echartService.fetchOption("RainydayFund-Bar"),this.echartService.fetchOption("RainydayFund-Pie")]).then(e=>{this.option1=e[0],this.option2=e[1],this.option3=e[2],this.option4=e[3]})}fetchReserves(){return this.graphService.fetchAllSwapPairDailyData().then(({data:e})=>{const i=e.pairs;this.reserveNames=[],this.currentReserveRatio=[],this.dailyReserveValue=[],this.totalReserve=0,i.forEach(s=>{this.reserveNames.push(s.token1.symbol),this.currentReserveRatio.push(1*s.prv),this.totalReserve+=1*s.prv;const r=Array(30).fill(null),l=(0,v.Gq)().reverse();s.pairDailyData.forEach(h=>{const c=l.indexOf(1e3*h.dayStartTimestamp);-1!==c&&(r[c]=1*h.prv)});let p=0;r.forEach((h,c)=>{null===h?r[c]=p:p=h}),this.dailyReserveValue.push(r)})}).then(()=>this.fetchRainydayFund())}fetchRainydayFund(){return this.graphService.fetchVaultFund(this.chainInfoService.getChainConfig().contractAddressMap.RainyDayFundVault.toLowerCase()).then(({data:e})=>{const i=e.fundVault?e.fundVault.dailyBalance:[];this.dailyRainydayFundValue=Array(this.reserveNames.length).fill(Array(30).fill(null));const s=(0,v.Gq)().reverse();i.forEach(r=>{const l=s.indexOf(1e3*r.dayStartTimestamp),p=this.reserveNames.indexOf(r.token.symbol);-1!==l&&-1!==p&&(this.dailyRainydayFundValue[p][l]=r.balance/r.token.decimals)}),this.dailyRainydayFundValue.forEach(r=>{let l=0;r.forEach((p,h)=>{null===p?r[h]=l:l=p})}),this.totalRainydayFund=0,this.currentRainydayFundRatio=this.dailyRainydayFundValue.map(r=>(this.totalRainydayFund+=r[r.length-1],r[r.length-1]))})}fetchTiUSDInfo(){return Promise.all([this.graphService.fetchTiUSDCirculation(),this.web3Service.invokeContract("MAMMSwapPair","getTiUSDPrice",[])]).then(([e,i])=>{const s=e.data.tiUSD&&e.data.tiUSD.tiusdCirculation?e.data.tiUSD.tiusdCirculation/10**18:0;this.TiUSDPrice=i[1]&&i[0]/10**18||1;const r=s>0?(100*(this.totalReserve+this.totalRainydayFund)/s).toFixed(2):100;this.reserveRatio=Number(r),this.TiUSDCirculation=s})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Z.Z),t.Y36(R.h),t.Y36(A.p),t.Y36(U.Uc),t.Y36(x.g))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-tiusd"]],decls:58,vars:28,consts:[[1,"tisud-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],["text","Current price of TiUSD in MAMM"],[1,"value"],["routerLink","/swap","mat-raised-button","","color","primary",1,"action-btn"],["text","TiUSD Circulation = TiUSD Total supply - TiUSD in MAMM"],["text","The ratio of total reserve value to total TiUSD in circulation."],[1,"mat-elevation-z4","chart-wrapper"],[2,"width","100%","height","100%",3,"option","showTitle"],[1,"pool-info-card","mat-elevation-z4"],[1,"pool-info-title"],[4,"ngFor","ngForOf"],[2,"grid-column-start","1","grid-column-end","3","display","grid","grid-template-columns","2fr 3fr 2fr","align-items","center"],[2,"justify-self","center"],[1,"pool-chart"],[2,"width","100%","height","100%",3,"option"],[2,"justify-self","start"],[2,"justify-self","end"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3,"TiUSD Price"),t._UZ(4,"titi-tooltip",3),t.qZA(),t.TgZ(5,"span",4),t._uU(6),t.ALo(7,"numberFormat"),t.qZA(),t.TgZ(8,"button",5),t._uU(9,"BUY"),t.qZA(),t.qZA(),t.TgZ(10,"div",1),t.TgZ(11,"h2",2),t._uU(12,"TiUSD Circulation"),t._UZ(13,"titi-tooltip",6),t.qZA(),t.TgZ(14,"span",4),t._uU(15),t.ALo(16,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(17,"div",1),t.TgZ(18,"h2",2),t._uU(19,"Reserve Ratio"),t._UZ(20,"titi-tooltip",7),t.qZA(),t.TgZ(21,"span",4),t._uU(22),t.ALo(23,"number"),t.qZA(),t.qZA(),t.TgZ(24,"div",8),t._UZ(25,"titi-chart-wrapper",9),t.qZA(),t.TgZ(26,"div",10),t.TgZ(27,"h2",11),t._uU(28,"Total Reserve Value"),t.qZA(),t.TgZ(29,"h3",11),t._uU(30),t.ALo(31,"numberFormat"),t.qZA(),t.YNc(32,D,6,5,"ng-container",12),t.TgZ(33,"div",13),t._UZ(34,"mat-divider"),t.TgZ(35,"mat-chip-list",14),t.TgZ(36,"mat-chip"),t._uU(37,"Assets Allocation"),t.qZA(),t.qZA(),t._UZ(38,"mat-divider"),t.qZA(),t.TgZ(39,"div",15),t._UZ(40,"titi-chart-wrapper",16),t.qZA(),t.qZA(),t.TgZ(41,"div",8),t._UZ(42,"titi-chart-wrapper",9),t.qZA(),t.TgZ(43,"div",10),t.TgZ(44,"h2",11),t._uU(45,"Rainy Day Fund"),t.qZA(),t.TgZ(46,"h3",11),t._uU(47),t.ALo(48,"numberFormat"),t.qZA(),t.YNc(49,O,6,5,"ng-container",12),t.TgZ(50,"div",13),t._UZ(51,"mat-divider"),t.TgZ(52,"mat-chip-list",14),t.TgZ(53,"mat-chip"),t._uU(54,"Assets Allocation"),t.qZA(),t.qZA(),t._UZ(55,"mat-divider"),t.qZA(),t.TgZ(56,"div",15),t._UZ(57,"titi-chart-wrapper",16),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.Oqu("$ "+t.xi3(7,13,i.TiUSDPrice,4)),t.xp6(9),t.Oqu(t.xi3(16,16,i.TiUSDCirculation,4)),t.xp6(7),t.Oqu(i.reserveRatio<100?"loading...":t.xi3(23,19,i.reserveRatio,"1.4-4")+"%"),t.xp6(3),t.Q6J("option",i.option1)("showTitle",!0),t.xp6(5),t.hij("$ ",t.xi3(31,22,i.totalReserve,4),""),t.xp6(2),t.Q6J("ngForOf",i.reserveNames),t.xp6(8),t.Q6J("option",i.option2),t.xp6(2),t.Q6J("option",i.option3)("showTitle",!0),t.xp6(5),t.hij("$ ",t.xi3(48,25,i.totalRainydayFund,4),""),t.xp6(2),t.Q6J("ngForOf",i.reserveNames),t.xp6(8),t.Q6J("option",i.option4))},directives:[S.Q,y.lW,g.rH,C.o,u.sg,T.d,m.qn,m.HS],pipes:[F.p,u.JJ],styles:[".tisud-wrapper[_ngcontent-%COMP%]{padding:12px 24px 24px 12px;display:grid;grid-template-columns:2fr 2fr 2fr 2fr 2fr 2fr 0fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:2rem;row-gap:2rem}.biz-info-card[_ngcontent-%COMP%]{min-height:80px;padding:18px;width:100%;grid-column-start:span 2;display:grid;grid-template-columns:1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 3;margin-left:48px;margin-bottom:20px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 2;margin-left:48px;align-self:end;font-size:18px;line-height:36px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 4;align-self:start;justify-self:start;width:100%;padding:12px 18px;height:100%}.pool-info-card[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:start;justify-self:start;width:100%;height:100%;padding:12px 18px;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:40px 40px 40px auto;grid-row-gap:1rem;row-gap:1rem;align-items:center}.pool-info-title[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3;height:40px;font-size:20px;justify-self:center;align-self:start}.pool-chart[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3;justify-self:center;width:100%;height:100%}@media screen and (max-width: 1024px){.tisud-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr;width:100%;padding:12px;grid-row-gap:1rem;row-gap:1rem}.biz-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px 48px}.chart-wrapper[_ngcontent-%COMP%], .pool-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px 48px;height:auto}}"]}),n})()}];let P=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[g.Bz.forChild(M)],g.Bz]}),n})();var w=a(45922),q=a(87841);let N=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[u.ez,P,T.t,m.Hi,w.F,q.m,y.ot]]}),n})()}}]);