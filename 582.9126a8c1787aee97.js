"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[582],{30582:(q,w,a)=>{a.r(w),a.d(w,{BuyTiTiModule:()=>x});var m=a(69808),b=a(71787),A=a(48634),R=a(5963),S=a(54004),D=a(52909),e=a(5e3),l=a(32681),c=a(65707),Z=a(47423),f=a(92134),v=a(20773);function P(r,p){if(1&r&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"date"),e.qZA(),e.TgZ(4,"span"),e._uU(5),e.ALo(6,"number"),e.qZA(),e.TgZ(7,"span"),e._uU(8),e.ALo(9,"number"),e.qZA(),e.TgZ(10,"span"),e._uU(11),e.ALo(12,"number"),e.qZA(),e.BQk()),2&r){const i=p.$implicit,n=e.oxw(2);e.xp6(2),e.Oqu(e.xi3(3,4,i.time,"y/M/dd")),e.xp6(3),e.hij("",e.xi3(6,7,n.formatTokenValue(i.personalBuyAmount,"18"),"1.2-4")," TiUSD"),e.xp6(3),e.hij("",e.xi3(9,10,n.formatTokenValue(i.totalBuyAmount,"18"),"1.2-4")," TiUSD"),e.xp6(3),e.hij("",e.xi3(12,13,n.formatTokenValue(i.confirmedRewards,"18"),"1.2-4")," TiTi")}}function h(r,p){if(1&r){const i=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"div",2),e.TgZ(2,"button",3),e.NdJ("click",function(){return e.CHM(i),e.oxw().goBack()}),e._uU(3," << back "),e.qZA(),e.qZA(),e._UZ(4,"div"),e.TgZ(5,"div",4),e.TgZ(6,"h1"),e._uU(7),e.qZA(),e.TgZ(8,"p"),e._uU(9,"This is a external-protocol incentive action. Since in the bootstrap stage, the liquidity of TiTi/TiUSD is relatively poor, and the potential slippage cost is high. Therefore, TiTi rewards are given to TiTi Buyer to stimulate users to buy TiTi. "),e.TgZ(10,"a",5),e._uU(11,"Click here to learn more about the detail rules"),e.qZA(),e._uU(12,"."),e.qZA(),e.qZA(),e.TgZ(13,"div",6),e.TgZ(14,"h2",7),e._uU(15,"Current Epoch Info"),e.qZA(),e.TgZ(16,"span",8),e._uU(17,"Rewards Period:"),e.qZA(),e.TgZ(18,"span",9),e._uU(19),e.ALo(20,"date"),e.ALo(21,"date"),e.qZA(),e.TgZ(22,"span",8),e._uU(23,"Total TiTi Rewards:"),e.qZA(),e.TgZ(24,"span",9),e._uU(25),e.ALo(26,"number"),e.qZA(),e.TgZ(27,"span",8),e._uU(28,"Rewards Rate"),e._UZ(29,"titi-tooltip",10),e._uU(30,":"),e.qZA(),e.TgZ(31,"span",9),e._uU(32),e.ALo(33,"number"),e.qZA(),e.qZA(),e.TgZ(34,"div",6),e.TgZ(35,"h2",7),e._uU(36,"Your Rewards Info"),e.qZA(),e.TgZ(37,"span",11),e._uU(38,"Your Distributed Rewards"),e._UZ(39,"titi-tooltip",12),e._uU(40,":"),e.qZA(),e.TgZ(41,"span",13),e._uU(42),e.ALo(43,"number"),e.qZA(),e.TgZ(44,"span",11),e._uU(45,"Today's Your Pending Rewards"),e._UZ(46,"titi-tooltip",14),e._uU(47,":"),e.qZA(),e.TgZ(48,"span",13),e._uU(49),e.ALo(50,"number"),e.qZA(),e.TgZ(51,"span",8),e._uU(52,"TiTi Rewards tAPY"),e._UZ(53,"titi-tooltip",15),e._uU(54,":"),e.qZA(),e.TgZ(55,"span",9),e._uU(56),e.ALo(57,"number"),e._UZ(58,"titi-tooltip",16),e._uU(59),e.ALo(60,"number"),e._UZ(61,"titi-tooltip",17),e.qZA(),e.qZA(),e.TgZ(62,"div",6),e.TgZ(63,"h2",7),e._uU(64,"Today's Your Pending Rewards Info"),e.qZA(),e.TgZ(65,"span",8),e._uU(66,"Today's Countdown:"),e.qZA(),e.TgZ(67,"span",9),e._uU(68),e.ALo(69,"async"),e.qZA(),e.TgZ(70,"span",8),e._uU(71,"Today's Total TiTi Rewards:"),e.qZA(),e.TgZ(72,"span",9),e._uU(73),e.ALo(74,"number"),e.qZA(),e.TgZ(75,"span",8),e._uU(76,"Today's Your Buy Amount:"),e.qZA(),e.TgZ(77,"span",9),e._uU(78),e.ALo(79,"number"),e.qZA(),e.TgZ(80,"span",8),e._uU(81,"Today's Total Buy Amount:"),e.qZA(),e.TgZ(82,"span",9),e._uU(83),e.ALo(84,"number"),e.qZA(),e.TgZ(85,"div",18),e.TgZ(86,"div",19),e._UZ(87,"mat-progress-spinner",20),e._UZ(88,"mat-progress-spinner",21),e.TgZ(89,"span"),e._uU(90),e.ALo(91,"number"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(92,"p",22),e._uU(93," If you maintain this percentage at the end of the day, you will earn "),e.TgZ(94,"span",23),e._uU(95),e.ALo(96,"number"),e.qZA(),e.qZA(),e.TgZ(97,"div",24),e._uU(98,"Buy more TiTi to get more TiTi rewards"),e.qZA(),e.qZA(),e.TgZ(99,"div",25),e.TgZ(100,"h2",7),e._uU(101,"Total Distributed Records"),e.qZA(),e.TgZ(102,"span",8),e._uU(103,"Total Confirmed Buy Amount"),e._UZ(104,"titi-tooltip",26),e._uU(105,":"),e.qZA(),e.TgZ(106,"span",9),e._uU(107),e.ALo(108,"number"),e.qZA(),e.TgZ(109,"span",8),e._uU(110,"Your Confirmed Buy Amount"),e._UZ(111,"titi-tooltip",27),e._uU(112,":"),e.qZA(),e.TgZ(113,"span",9),e._uU(114),e.ALo(115,"number"),e.qZA(),e._UZ(116,"span"),e._UZ(117,"span"),e.TgZ(118,"div",28),e.TgZ(119,"span"),e._uU(120,"Time"),e.qZA(),e.TgZ(121,"span"),e._uU(122,"Your recorded buy amount"),e.qZA(),e.TgZ(123,"span"),e._uU(124,"Total recorded buy amount"),e.qZA(),e.TgZ(125,"span"),e._uU(126,"Confirmed Rewards"),e.qZA(),e._UZ(127,"div",29),e.TgZ(128,"div",30),e.YNc(129,P,13,16,"ng-container",31),e.ALo(130,"async"),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&r){const i=e.oxw();e.xp6(7),e.hij("Buy TiTi in TiTi/TiUSD Pair (",i.chainInfoService.getChainConfig().swapDexName,")"),e.xp6(12),e.AsE(" UTC ",e.Dn7(20,21,1e3*i.use2earnService.currentEpochInfo.starttime,"y/M/dd HH:mm:ss","UTC")," - UTC ",e.Dn7(21,25,1e3*i.use2earnService.currentEpochInfo.starttime+1e3*i.use2earnService.currentEpochInfo.duration,"y/M/dd HH:mm:ss","UTC")," "),e.xp6(6),e.hij("",e.xi3(26,29,i.formatTokenValue(i.use2earnService.currentEpochInfo.buyTiTiReward,"18"),"1.2-4")," TiTi"),e.xp6(4),e.Q6J("text","The number of TiTi rewards distributed daily, according to the rules, is determined at 8:00:00 UTC every day in the past 24H, and is distributed according to the proportion of the user's TiTi bought amount in TiTi/TiUSD Pair ("+i.chainInfoService.getChainConfig().swapDexName+")."),e.xp6(3),e.hij("",e.xi3(33,32,i.getBuyTiTiRewardRate(),"1.2-4")," TiTi / Day"),e.xp6(10),e.hij("",e.xi3(43,35,i.use2earnService.buyTiTiPersonalReward-i.use2earnService.buyTiTiPersonalRewardRate,"1.4-4")," TiTi"),e.xp6(7),e.hij("",e.xi3(50,38,i.use2earnService.buyTiTiPersonalRewardRate,"1.4-4")," TiTi"),e.xp6(7),e.hij("Daily ",e.xi3(57,41,100*i.use2earnService.buyTiTiDailyApy,"1.2-4"),"%"),e.xp6(3),e.hij(" / Avg ",e.xi3(60,44,100*i.use2earnService.buyTiTiAvgApy,"1.2-4"),"%"),e.xp6(9),e.Oqu(e.lcZ(69,47,i.countDown$)),e.xp6(5),e.hij("",e.xi3(74,49,i.getBuyTiTiRewardRate(),"1.2-4")," TiTi"),e.xp6(5),e.hij("",e.xi3(79,52,i.formatTokenValue(i.use2earnService.buyTiTiPersonalAmount+"","18"),"1.4-4")," TiTi"),e.xp6(5),e.hij("",e.xi3(84,55,i.formatTokenValue(i.use2earnService.buyTiTiTotalAmount+"","18"),"1.4-4")," TiTi"),e.xp6(4),e.Q6J("value",100),e.xp6(1),e.Q6J("value",i.use2earnService.buyTiTiPersonalProportion),e.xp6(2),e.hij("",e.xi3(91,58,i.use2earnService.buyTiTiPersonalProportion,"1.2-2"),"%"),e.xp6(5),e.hij("",e.xi3(96,61,i.use2earnService.buyTiTiPersonalRewardRate,"1.4-4")," TiTi"),e.xp6(12),e.hij("",e.xi3(108,64,i.formatTokenValue(i.use2earnService.buyTiTiEpochTotalAmount.toString(),"18"),"1.2-4")," TiTi"),e.xp6(7),e.hij("",e.xi3(115,67,i.formatTokenValue(i.use2earnService.buyTiTiEpochPersonalAmount.toString(),"18"),"1.2-4")," TiTi"),e.xp6(15),e.Q6J("ngForOf",e.lcZ(130,70,i.buyTiTiRecord$))}}const I=[{path:"",component:(()=>{class r{constructor(i,n,T){this.location=i,this.use2earnService=n,this.chainInfoService=T,this.countDown$=(0,R.H)(0,1e3).pipe((0,S.U)(()=>this.hms(864e5-((new Date).getTime()-288e5)%864e5))),this.buyTiTiRecord$=this.use2earnService.dailyUserSwap$.pipe((0,S.U)(y=>y.map(u=>({time:1e3*u.dailySwap.dayStartTimestamp,personalBuyAmount:u.dailySwap.dailyTotalVolume,totalBuyAmount:u.dailyVolume,confirmedRewards:D.O$.from(u.dailySwap.dailyTotalVolume).mul((0,A.parseUnits)(this.use2earnService.buyTiTiRewardRate+"","18")).div(D.O$.from(u.dailyVolume)).toString()})).filter(u=>u.time!=864e5*Math.floor(((new Date).getTime()-288e5)/864e5)).sort((u,_)=>_.time-u.time)))}ngOnInit(){}goBack(){this.location.back()}formatTokenValue(i,n){return(0,A.formatUnits)(i,n)}getBuyTiTiRewardRate(){return this.use2earnService.currentEpochInfo.buyTiTiReward/10**18*86400/this.use2earnService.currentEpochInfo.duration}hms(i){return i>0?[parseInt(i%864e5/36e5+"")+"h",parseInt(i%36e5/6e4+"")+"m",parseInt(i%6e4/1e3+"")+"s"].join(":"):[" -- h"," -- m"," -- s"].join(":")}}return r.\u0275fac=function(i){return new(i||r)(e.Y36(m.Ye),e.Y36(l.Q),e.Y36(c.Z))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-buy-ti-ti"]],decls:1,vars:1,consts:[["class","buy-titi-wrapper",4,"ngIf"],[1,"buy-titi-wrapper"],[2,"position","absolute"],["mat-button","","color","primary",1,"back-btn",3,"click"],[1,"page-title",2,"grid-column-start","span 2"],["href","https://blog.titi.finance/mmf-an-innovative-unilateral-liquidity-provision-paradigm-in-defi-world-991e87863d97","target","_blank"],[1,"info-card","mat-elevation-z4"],[2,"justify-self","center","grid-column-start","span 2"],[2,"justify-self","start"],[2,"justify-self","end"],[3,"text"],[1,"golden-highlight",2,"justify-self","start"],["text","You have been allocated TiTi rewards, which can be claimed on the Use-To-Earn page."],[1,"golden-highlight",2,"justify-self","end"],["text","This value is a reference value based on your accumulated TiTi bought amount of the day. Since the day is not over yet, this value is variable. It will be confirmed and accumulated into your distributed rewards at UTC 8:00:00 every day, and recorded again."],["text","This token APY(tAPY) based on current prices of TiTi, current epoch's reward rate and the proportion of your TiTi bought amount in the total TiTi bought amount."],["text","Estimated value based on today's pending rewards."],["text","Estimated value based on the distributed rewards from the beginning till now."],[2,"justify-self","center","grid-column-start","span 2","position","relative","display","flex","justify-content","center","align-items","center"],[2,"height","90px","width","90px","display","flex","justify-content","center","align-items","center"],["color","warn","mode","determinate",2,"position","absolute",3,"value"],["color","primary","mode","determinate",2,"position","absolute",3,"value"],[2,"justify-self","center","grid-column-start","span 2","font-size","1rem","width","80%","text-align","center","color","rgb(123, 255, 193)"],[1,"golden-highlight"],[1,"btn"],[1,"info-card","mat-elevation-z4",2,"grid-template-rows","auto auto auto auto 1fr"],["text","The total confirmed cumulative purchase of TiTi over the past period of time."],["text","Your confirmed cumulative purchase of TiTi over the past period of time."],[2,"font-size","0.5vw","justify-self","center","align-self","start","grid-column-start","span 2","display","grid","grid-template-columns","1fr 1fr 1fr 1fr","column-gap","4px","row-gap","1rem","justify-items","center","align-items","center"],[1,"divider",2,"justify-self","center","grid-column-start","span 4"],[2,"width","100%","justify-self","center","align-self","start","grid-column-start","span 4","display","grid","grid-template-columns","1fr 1fr 1fr 1fr","column-gap","4px","row-gap","1rem","justify-items","center","align-items","center","max-height","30vh","overflow-y","scroll"],[4,"ngFor","ngForOf"]],template:function(i,n){1&i&&e.YNc(0,h,131,72,"div",0),2&i&&e.Q6J("ngIf",n.use2earnService.currentEpochInfo)},directives:[m.O5,Z.lW,f.Q,v.Ou,m.sg],pipes:[m.uU,m.JJ,m.Ov],styles:[".buy-titi-wrapper[_ngcontent-%COMP%]{padding:24px;display:grid;grid-template-columns:1fr 1fr;grid-column-gap:2vw;column-gap:2vw;grid-row-gap:2vw;row-gap:2vw}.back-btn[_ngcontent-%COMP%]{text-decoration:underline}.info-card[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:auto auto;grid-row-gap:1rem;row-gap:1rem;align-items:center}.btn[_ngcontent-%COMP%]{border:2px solid #fdff79;color:#fdff79;padding:1rem;font-weight:bolder;border-radius:2rem;justify-self:center;grid-column-start:span 2;cursor:pointer;-webkit-background-clip:text;background-clip:text;background-image:linear-gradient(180deg,#e6b7ff,#ffe48c,#ffd058,#d7abff 75%,transparent);-webkit-text-fill-color:transparent;box-shadow:0 0 6px 4px #fffa9700;-webkit-backdrop-filter:brightness(.9);backdrop-filter:brightness(.9)}.btn[_ngcontent-%COMP%]:hover{border:2px solid #f8faad;color:#f8faad;background-image:linear-gradient(180deg,#d483ff,#fdd75a,#ffb700,#bf7bff 75%,transparent);box-shadow:0 0 6px 4px #fffa974d;-webkit-backdrop-filter:brightness(1.5);backdrop-filter:brightness(1.5)}"]}),r})()}];let M=(()=>{class r{}return r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[b.Bz.forChild(I)],b.Bz]}),r})();var E=a(87841);let x=(()=>{class r{}return r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[m.ez,M,Z.ot,v.Cq,E.m]]}),r})()},32681:(q,w,a)=>{a.d(w,{Q:()=>x});var m=a(15861),b=a(57959),A=a(94528),R=a(57424),S=a(32856),D=a(98538),e=a.n(D),l=a(52909),c=a(48634),f=a(61135),v=a(5963),P=a(54004),h=a(5e3),O=a(57610),I=a(53405),M=a(11730),E=a(65707);let x=(()=>{class r{constructor(i,n,T,y){this.accountService=i,this.graphService=n,this.web3Service=T,this.chainInfoService=y,this.buyTiUSDReward=0,this.buyTiUSDPersonalReward=0,this.buyTiUSDRewardRate=0,this.buyTiUSDPersonalRewardRate=0,this.buyTiUSDTotalAmount=0,this.buyTiUSDPersonalAmount=0,this.buyTiUSDPersonalProportion=0,this.buyTiUSDAvgApy=0,this.buyTiUSDDailyApy=0,this.buyTiUSDEpochPersonalAmount=l.O$.from("0"),this.buyTiUSDEpochTotalAmount=l.O$.from("0"),this.holdTiUSDReward=0,this.holdTiUSDPersonalReward=0,this.holdTiUSDRewardRate=0,this.holdTiUSDPersonalRewardRate=0,this.holdTotalTiUSDAmount="0",this.holdTiUSDBalance="0",this.holdTiUSDApy=0,this.buyTiTiReward=0,this.buyTiTiPersonalReward=0,this.buyTiTiRewardRate=0,this.buyTiTiPersonalRewardRate=0,this.buyTiTiPersonalAmount=0,this.buyTiTiTotalAmount=0,this.buyTiTiEpochPersonalAmount=l.O$.from("0"),this.buyTiTiEpochTotalAmount=l.O$.from("0"),this.buyTiTiPersonalProportion=0,this.buyTiTiAvgApy=0,this.buyTiTiDailyApy=0,this.totalClaimableRewards=0,this.distributedTiTiRewards=0,this.top20Users$=new f.X([]),this.dailyUserMint$=new f.X([]),this.dailyUserSwap$=new f.X([]),this.APIURL="https://api.thegraph.com/subgraphs/name/titimainnet/titi-use-to-earn",this.client=new b.f({uri:this.APIURL,cache:new A.h}),this.chainInfoService.currentChainId$.subscribe(u=>{this.setNewApi(this.chainInfoService.getChainConfig(u).use2earnApi)}),(0,v.H)(2e3,1e4).pipe((0,P.U)(()=>this.fetchUserData())).subscribe()}getNewBuyTiUSDPersonalProportion(i){return 100*(this.buyTiUSDPersonalAmount+i*10**18)/(this.buyTiUSDTotalAmount+i*10**18)}getNewbuyTiUSDPersonalRewardRate(i){return this.getNewBuyTiUSDPersonalProportion(i)*this.buyTiUSDRewardRate/100}getExpectedDailyRewards(i){return l.O$.from(this.holdTotalTiUSDAmount).isZero()?0:this.holdTiUSDRewardRate*(l.O$.from(i).mul(l.O$.from("10000")).div(l.O$.from(this.holdTotalTiUSDAmount)).toNumber()/1e4)}setNewApi(i){this.client.setLink(new R.u({uri:i}))}fetchUserData(){var i=this;return Promise.all([this.web3Service.invokeContract("TiTiUse2EarnBackendV1","getCurrentEpochInfo",["0"]),this.web3Service.invokeContract("TiTiUse2EarnBackendV1","getCurrentEpochInfo",["1"]),this.web3Service.invokeContract("TiTiUse2EarnBackendV1","getCurrentEpochInfo",["2"])]).then(([n,T,y])=>(this.currentEpochInfo={epochNum:n[0],duration:n[2],starttime:n[3],holdTiUSDReward:n[1],buyTiTiReward:y[1],buyTiUSDReward:T[1],totalRewards:l.O$.from(n[1]).add(l.O$.from(y[1])).add(l.O$.from(T[1])).toString()},this.currentEpochInfo)).then(function(){var n=(0,m.Z)(function*({epochNum:T,duration:y,starttime:u,holdTiUSDReward:_,buyTiTiReward:k,buyTiUSDReward:W}){const s=1e3*u,d=y/86400,C=parseFloat((0,c.formatUnits)(W,"18")),B=parseFloat((0,c.formatUnits)(_,"18")),$=parseFloat((0,c.formatUnits)(k,"18"));i.buyTiUSDReward=C,i.buyTiUSDRewardRate=C/d,i.holdTiUSDReward=B,i.holdTiUSDRewardRate=B/d,i.buyTiTiReward=$,i.buyTiTiRewardRate=$/d;const U=yield i.fetchTiTiPrice();return i.fetchUserDailyData(T,s,s+1e3*y).then(({data:t})=>{i.buyTiUSDPersonalReward=0,i.holdTiUSDPersonalReward=0,i.buyTiTiPersonalReward=0,i.buyTiUSDPersonalRewardRate=0,i.holdTiUSDPersonalRewardRate=0,i.buyTiTiPersonalRewardRate=0,i.buyTiUSDEpochPersonalAmount=l.O$.from("0"),i.buyTiUSDEpochTotalAmount=l.O$.from("0"),i.buyTiTiEpochPersonalAmount=l.O$.from("0"),i.buyTiTiEpochTotalAmount=l.O$.from("0");const V=Math.floor(((new Date).getTime()-288e5)/864e5),L=Math.floor((s-288e5)/864e5);function j(){let o;const g=(new Date).getTime();return o=g<s?s:g<s+24*d*3600*1e3?g:s+24*d*3600*1e3,o/1e3}t.dailySwaps.forEach(o=>{1e3*(o.dayStartTimestamp+28800)>=s&&1e3*(o.dayStartTimestamp+28800)<s+24*d*3600*1e3&&(i.buyTiTiEpochTotalAmount=i.buyTiTiEpochTotalAmount.add(l.O$.from(o.dailyTotalVolume)))}),t.dailyMints.forEach(o=>{1e3*(o.dayStartTimestamp+28800)>=s&&1e3*(o.dayStartTimestamp+28800)<s+24*d*3600*1e3&&(i.buyTiUSDEpochTotalAmount=i.buyTiUSDEpochTotalAmount.add(l.O$.from(o.dailyTotalVolume)))}),i.buyTiUSDTotalAmount=(new Date).getTime()<s+24*d*3600*1e3&&t.dailyMint&&t.dailyMint.dailyTotalVolume?t.dailyMint.dailyTotalVolume:0,i.buyTiTiTotalAmount=(new Date).getTime()<s+24*d*3600*1e3&&t.dailySwap&&t.dailySwap.dailyTotalVolume?t.dailySwap.dailyTotalVolume:0,i.buyTiUSDDailyApy=i.buyTiUSDTotalAmount>0?i.buyTiUSDRewardRate*U*365/(i.buyTiUSDTotalAmount/10**18):0,i.buyTiUSDAvgApy=i.buyTiUSDEpochTotalAmount.isZero()?0:i.buyTiUSDRewardRate*U*365/(i.buyTiUSDEpochTotalAmount.div(l.O$.from(10**14)).toNumber()/1e3/(V-L)),i.buyTiTiDailyApy=i.buyTiTiTotalAmount>0?i.buyTiTiRewardRate*U*365/(i.buyTiTiTotalAmount/10**18):0,i.buyTiTiAvgApy=i.buyTiTiEpochTotalAmount.isZero()?0:i.buyTiTiRewardRate*U*365/(i.buyTiTiEpochTotalAmount.div(l.O$.from(10**14)).toNumber()/1e3/(V-L)),i.holdTiUSDPersonalReward=parseFloat((0,c.formatUnits)(new(e())(t.epochUser.rewards).add(new(e())(t.user.balance).mul(function(o){if(0===Number.parseInt(o.totalSupply))return new(e())(o.rewardPerTokenStored);const g=new(e())(j()-1*o.lastUpdateTime).mul(new(e())(_)).mul(new(e())("1000000000000000000")).div(new(e())(o.totalSupply).mul(new(e())(86400)).mul(new(e())(d)));return new(e())(o.rewardPerTokenStored).add(g)}(t.holder).sub(new(e())(t.epochUser.userRewardPerTokenPaid))).div(new(e())("10").pow(new(e())("18")))).toString(),"18")),i.holdTotalTiUSDAmount=t.holder.totalSupply,i.holdTiUSDApy=i.holdTiUSDRewardRate*U*365/(t.holder.totalSupply/10**18),t.user&&t.epochUser&&(i.dailyUserMint$.next(t.user.dailyUserMint),i.dailyUserSwap$.next(t.user.dailyUserSwap),t.user.dailyUserMint.forEach(o=>{1e3*(o.dailyMint.dayStartTimestamp+28800)>=s&&1e3*(o.dailyMint.dayStartTimestamp+28800)<s+24*d*3600*1e3&&(i.buyTiUSDPersonalReward+=i.buyTiUSDRewardRate*o.dailyVolume/o.dailyMint.dailyTotalVolume,i.buyTiUSDEpochPersonalAmount=i.buyTiUSDEpochPersonalAmount.add(l.O$.from(o.dailyVolume)))}),i.holdTiUSDBalance=t.user.balance,t.user.dailyUserSwap.forEach(o=>{1e3*(o.dailySwap.dayStartTimestamp+28800)>=s&&1e3*(o.dailySwap.dayStartTimestamp+28800)<s+24*d*3600*1e3&&(i.buyTiTiPersonalReward+=i.buyTiTiRewardRate*o.dailyVolume/o.dailySwap.dailyTotalVolume,i.buyTiTiEpochPersonalAmount=i.buyTiTiEpochPersonalAmount.add(l.O$.from(o.dailyVolume)))}),i.buyTiUSDPersonalRewardRate=(new Date).getTime()<s+24*d*3600*1e3&&t.dailyUserMint&&t.dailyUserMint.dailyMint.dailyTotalVolume?i.buyTiUSDRewardRate*t.dailyUserMint.dailyVolume/t.dailyUserMint.dailyMint.dailyTotalVolume:0,i.buyTiUSDPersonalAmount=(new Date).getTime()<s+24*d*3600*1e3&&t.dailyUserMint&&t.dailyUserMint.dailyMint.dailyTotalVolume?t.dailyUserMint.dailyVolume:0,i.buyTiUSDPersonalProportion=(new Date).getTime()<s+24*d*3600*1e3&&t.dailyUserMint&&t.dailyUserMint.dailyMint.dailyTotalVolume?t.dailyUserMint.dailyVolume/t.dailyUserMint.dailyMint.dailyTotalVolume*100:0,i.buyTiTiPersonalRewardRate=(new Date).getTime()<s+24*d*3600*1e3&&t.dailyUserSwap&&t.dailyUserSwap.dailySwap.dailyTotalVolume?i.buyTiTiRewardRate*(t.dailyUserSwap.dailyVolume/10**18)/(t.dailyUserSwap.dailySwap.dailyTotalVolume/10**18):0,i.buyTiTiPersonalAmount=(new Date).getTime()<s+24*d*3600*1e3&&t.dailyUserSwap&&t.dailyUserSwap.dailySwap.dailyTotalVolume?t.dailyUserSwap.dailyVolume:0,i.buyTiTiPersonalProportion=(new Date).getTime()<s+24*d*3600*1e3&&t.dailyUserSwap&&t.dailyUserSwap.dailySwap.dailyTotalVolume?t.dailyUserSwap.dailyVolume/t.dailyUserSwap.dailySwap.dailyTotalVolume*100:0,i.holdTiUSDPersonalRewardRate=(new Date).getTime()<s+24*d*3600*1e3?i.holdTiUSDRewardRate*t.user.balance/t.holder.totalSupply:0),i.distributedTiTiRewards=(1e3*j()-s)/864e5*(i.buyTiUSDRewardRate+i.holdTiUSDRewardRate+i.buyTiTiRewardRate),i.top20Users$.next(t.users)})});return function(T){return n.apply(this,arguments)}}())}fetchTiTiPrice(){return Promise.all([this.web3Service.invokeContract("UniswapV2Pair","getReserves",[]),this.graphService.fetchTodayMMFRewardData(this.chainInfoService.getChainConfig().contractAddressMap.MAMMSwapPair)]).then(i=>i[0][1]/i[0][0]*(i[1].data.pair.fund1*10**12/i[1].data.pair.fund0))}fetchUserDailyData(i,n,T){return this.accountService.getCurrentAccountAsyn().then(u=>this.client.query({query:(0,S.Ps)("\n    query($userId: ID,$epochUserId: ID,$epochId:ID,$dayId:ID,$startDayId:ID,$endDayId:ID,$startId:ID,$endId:ID,$todayId:ID) {\n      epochUser(id:$epochUserId){\n        userRewardPerTokenPaid\n        rewards\n      }\n      users(first:20,orderBy:balance,orderDirection:desc){\n        address\n        balance\n      }\n      user(id:$userId){\n        id\n        address\n        balance\n        dailyUserTransfer(first:1000,where:{id_gte:$startDayId,id_lte:$endDayId}){\n          dailyTransfer{\n            dayStartTimestamp\n            dailyTotalVolume\n          }\n          dailyVolume\n        }\n        dailyUserMint(first:1000,where:{id_gte:$startDayId,id_lte:$endDayId}){\n          dailyMint{\n            dayStartTimestamp\n            dailyTotalVolume\n          }\n          dailyVolume\n        }\n        dailyUserSwap(first:1000,where:{id_gte:$startDayId,id_lte:$endDayId}){\n          dailySwap{\n            dayStartTimestamp\n            dailyTotalVolume\n          }\n          dailyVolume\n        }\n      }\n      holder(id:$epochId){\n        lastUpdateTime\n        rewardPerTokenStored\n        totalSupply\n      }\n      dailyUserTransfer(id:$dayId){\n        dailyVolume\n        dailyTransfer{\n          dailyTotalVolume\n        }\n      }\n      dailyUserMint(id:$dayId){\n        dailyVolume\n        dailyMint{\n          dailyTotalVolume\n        }\n      }\n      dailyUserSwap(id:$dayId){\n        dailyVolume\n        dailySwap{\n          dailyTotalVolume\n        }\n      }\n      dailySwaps(first:1000,where:{id_gte:$startId,id_lte:$endId}){\n        id\n        dailyTotalVolume\n        dayStartTimestamp\n      }\n      dailyMints(first:1000,where:{id_gte:$startId,id_lte:$endId}){\n        id\n        dailyTotalVolume\n        dayStartTimestamp\n      }\n      dailySwap(id:$todayId){\n        id\n        dailyTotalVolume\n        dayStartTimestamp\n      }\n      dailyMint(id:$todayId){\n        id\n        dailyTotalVolume\n        dayStartTimestamp\n      }\n   }\n  "),variables:{userId:u.toLowerCase(),epochUserId:i+"-0-"+u.toLowerCase(),epochId:i,dayId:u.toLowerCase()+"-"+Math.floor(((new Date).getTime()-288e5)/864e5),startDayId:u.toLowerCase()+"-"+Math.floor((n-288e5)/864e5),endDayId:u.toLowerCase()+"-"+Math.floor((T-288e5)/864e5),startId:Math.floor((n-288e5)/864e5),endId:Math.floor((T-288e5)/864e5),todayId:Math.floor(((new Date).getTime()-288e5)/864e5)},fetchPolicy:"network-only"}))}}return r.\u0275fac=function(i){return new(i||r)(h.LFG(O.B),h.LFG(I.h),h.LFG(M.Uc),h.LFG(E.Z))},r.\u0275prov=h.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})()}}]);