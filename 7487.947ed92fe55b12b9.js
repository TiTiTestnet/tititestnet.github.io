"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[7487],{45922:(C,_,n)=>{n.d(_,{F:()=>S});var p=n(69808),h=n(48966),b=n(87841),w=n(5e3);let S=(()=>{class m{}return m.\u0275fac=function(u){return new(u||m)},m.\u0275mod=w.oAB({type:m}),m.\u0275inj=w.cJS({imports:[[p.ez,h.Is,b.m]]}),m})()},97487:(C,_,n)=>{n.r(_),n.d(_,{BuyTiusdModule:()=>t});var p=n(69808),h=n(71787),b=n(48634),w=n(5963),S=n(54004),m=n(52909),e=n(5e3),u=n(32681),c=n(47423),B=n(92134),D=n(20773);function v(a,d){if(1&a&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"date"),e.qZA(),e.TgZ(4,"span"),e._uU(5),e.ALo(6,"number"),e.qZA(),e.TgZ(7,"span"),e._uU(8),e.ALo(9,"number"),e.qZA(),e.TgZ(10,"span"),e._uU(11),e.ALo(12,"number"),e.qZA(),e.BQk()),2&a){const o=d.$implicit,i=e.oxw(3);e.xp6(2),e.Oqu(e.xi3(3,4,o.time,"dd/M/y")),e.xp6(3),e.hij("",e.xi3(6,7,i.formatTokenValue(o.personalBuyAmount,"18"),"1.2-4")," TiUSD"),e.xp6(3),e.hij("",e.xi3(9,10,i.formatTokenValue(o.totalBuyAmount,"18"),"1.2-4")," TiUSD"),e.xp6(3),e.hij("",e.xi3(12,13,i.formatTokenValue(o.confirmedRewards,"18"),"1.2-4")," TiTi")}}function M(a,d){1&a&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2,"No Data."),e.qZA(),e.BQk())}function U(a,d){if(1&a&&(e.ynx(0),e.YNc(1,v,13,16,"ng-container",34),e.YNc(2,M,3,0,"ng-container",35),e.BQk()),2&a){const o=d.ngIf;e.xp6(1),e.Q6J("ngForOf",o),e.xp6(1),e.Q6J("ngIf",0==o.length)}}function P(a,d){1&a&&(e.TgZ(0,"span"),e._uU(1,"No Data."),e.qZA())}function Z(a,d){if(1&a){const o=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"div",2),e.TgZ(2,"button",3),e.NdJ("click",function(){return e.CHM(o),e.oxw().goBack()}),e._uU(3," << back "),e.qZA(),e.qZA(),e._UZ(4,"div"),e.TgZ(5,"div",4),e.TgZ(6,"h1"),e._uU(7,"Buy TiUSD in TiTi-AMMs (Swap)"),e.qZA(),e.TgZ(8,"p"),e._uU(9,"This is an internal-protocol incentive action. TiTi rewards will be distributed to TiUSD Buyers in TiTi-AMMs in USDC. "),e.TgZ(10,"a",5),e._uU(11,"Click to Learn More"),e.qZA(),e._uU(12,"."),e.qZA(),e.qZA(),e.TgZ(13,"div",6),e.TgZ(14,"h2",7),e._uU(15,"Current Epoch Info"),e.qZA(),e.TgZ(16,"span",8),e._uU(17,"Rewards Period:"),e.qZA(),e.TgZ(18,"div",9),e.TgZ(19,"span"),e._uU(20),e.ALo(21,"date"),e.qZA(),e.TgZ(22,"span"),e._uU(23),e.ALo(24,"date"),e.qZA(),e.qZA(),e.TgZ(25,"span",8),e._uU(26,"Total TiTi Rewards:"),e.qZA(),e.TgZ(27,"span",10),e._uU(28),e.ALo(29,"number"),e.qZA(),e.TgZ(30,"span",8),e._uU(31,"Rewards Rate"),e._UZ(32,"titi-tooltip",11),e._uU(33,":"),e.qZA(),e.TgZ(34,"span",10),e._uU(35),e.ALo(36,"number"),e.qZA(),e.qZA(),e.TgZ(37,"div",6),e.TgZ(38,"h2",7),e._uU(39,"Your Rewards Info"),e.qZA(),e.TgZ(40,"span",12),e._uU(41,"Your Distributed Rewards"),e._UZ(42,"titi-tooltip",13),e._uU(43,":"),e.qZA(),e.TgZ(44,"span",14),e._uU(45),e.ALo(46,"number"),e.qZA(),e.TgZ(47,"span",12),e._uU(48,"Your Pending Rewards today"),e._UZ(49,"titi-tooltip",15),e._uU(50,":"),e.qZA(),e.TgZ(51,"span",14),e._uU(52),e.ALo(53,"number"),e.qZA(),e.TgZ(54,"span",8),e._uU(55,"TiTi Rewards tAPY"),e._UZ(56,"titi-tooltip",16),e._uU(57,":"),e.qZA(),e.TgZ(58,"span",10),e._uU(59),e.ALo(60,"number"),e._UZ(61,"titi-tooltip",17),e._uU(62),e.ALo(63,"number"),e._UZ(64,"titi-tooltip",18),e.qZA(),e.qZA(),e.TgZ(65,"div",6),e.TgZ(66,"h2",7),e._uU(67,"Your Pending Rewards Info today"),e.qZA(),e.TgZ(68,"span",8),e._uU(69,"Countdown today:"),e.qZA(),e.TgZ(70,"span",10),e._uU(71),e.ALo(72,"async"),e.qZA(),e.TgZ(73,"span",8),e._uU(74,"Total TiTi Rewards today:"),e.qZA(),e.TgZ(75,"span",10),e._uU(76),e.ALo(77,"number"),e.qZA(),e.TgZ(78,"span",8),e._uU(79,"Your Buy Amount today:"),e.qZA(),e.TgZ(80,"span",10),e._uU(81),e.ALo(82,"number"),e.qZA(),e.TgZ(83,"span",8),e._uU(84,"Total Buy Amount today:"),e.qZA(),e.TgZ(85,"span",10),e._uU(86),e.ALo(87,"number"),e.qZA(),e.TgZ(88,"div",19),e.TgZ(89,"div",20),e._UZ(90,"mat-progress-spinner",21),e._UZ(91,"mat-progress-spinner",22),e.TgZ(92,"span"),e._uU(93),e.ALo(94,"number"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(95,"p",23),e._uU(96," You proportion against all TiUSD buyers per second,"),e.qZA(),e.TgZ(97,"p",23),e._uU(98," you will earn "),e.TgZ(99,"span",24),e._uU(100),e.ALo(101,"number"),e.qZA(),e._uU(102," today if it doesn't change."),e.qZA(),e.TgZ(103,"div",25),e._uU(104,"Buy more TiUSD earns you more $TiTi Rewards"),e.qZA(),e.qZA(),e.TgZ(105,"div",26),e.TgZ(106,"h2",7),e._uU(107,"Current Epoch Rewards Distribution Records"),e.qZA(),e.TgZ(108,"span",8),e._uU(109,"Total TiUSD Buy Amount"),e._UZ(110,"titi-tooltip",27),e._uU(111," :"),e.qZA(),e.TgZ(112,"span",10),e._uU(113),e.ALo(114,"number"),e.qZA(),e.TgZ(115,"span",8),e._uU(116,"Your Confirmed Buy Amount"),e._UZ(117,"titi-tooltip",28),e._uU(118,":"),e.qZA(),e.TgZ(119,"span",10),e._uU(120),e.ALo(121,"number"),e.qZA(),e._UZ(122,"span"),e._UZ(123,"span"),e.TgZ(124,"div",29),e.TgZ(125,"span"),e._uU(126,"Time"),e.qZA(),e.TgZ(127,"span"),e._uU(128,"Your recorded buy amount"),e.qZA(),e.TgZ(129,"span"),e._uU(130,"Total recorded buy amount"),e.qZA(),e.TgZ(131,"span"),e._uU(132,"Confirmed Rewards"),e.qZA(),e._UZ(133,"div",30),e.TgZ(134,"div",31),e.YNc(135,U,3,2,"ng-container",32),e.ALo(136,"async"),e.YNc(137,P,2,0,"ng-template",null,33,e.W1O),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&a){const o=e.MAs(138),i=e.oxw();e.xp6(20),e.hij("",e.Dn7(21,20,1e3*i.use2earnService.currentEpochInfo.starttime,"MMMM-d-y h:mm:ss a","UTC")," +UTC"),e.xp6(3),e.hij(" - ",e.Dn7(24,24,1e3*i.use2earnService.currentEpochInfo.starttime+1e3*i.use2earnService.currentEpochInfo.duration,"MMMM-d-y h:mm:ss a","UTC")," +UTC"),e.xp6(5),e.hij(" ",e.xi3(29,28,i.formatTokenValue(i.use2earnService.currentEpochInfo.buyTiUSDReward,"18"),"1.2-4")," TiTi"),e.xp6(7),e.hij("",e.xi3(36,31,i.getBuyTiUSDRewardRate(),"1.2-4")," TiTi / Day"),e.xp6(10),e.hij("",e.xi3(46,34,i.use2earnService.buyTiUSDPersonalReward-i.use2earnService.buyTiUSDPersonalRewardRate,"1.4-4")," TiTi"),e.xp6(7),e.hij("",e.xi3(53,37,i.use2earnService.buyTiUSDPersonalRewardRate,"1.4-4")," TiTi"),e.xp6(7),e.hij("Daily ",e.xi3(60,40,100*i.use2earnService.buyTiUSDDailyApy,"1.2-4"),"% "),e.xp6(3),e.hij("/ Avg ",e.xi3(63,43,100*i.use2earnService.buyTiUSDAvgApy,"1.2-4"),"%"),e.xp6(9),e.Oqu(e.lcZ(72,46,i.countDown$)),e.xp6(5),e.hij("",e.xi3(77,48,i.getBuyTiUSDRewardRate(),"1.2-4")," TiTi"),e.xp6(5),e.hij("",e.xi3(82,51,i.formatTokenValue(i.use2earnService.buyTiUSDPersonalAmount+"","18"),"1.4-4")," TiUSD"),e.xp6(5),e.hij("",e.xi3(87,54,i.formatTokenValue(i.use2earnService.buyTiUSDTotalAmount+"","18"),"1.4-4")," TiUSD"),e.xp6(4),e.Q6J("value",100),e.xp6(1),e.Q6J("value",i.use2earnService.buyTiUSDPersonalProportion),e.xp6(2),e.hij("",e.xi3(94,57,i.use2earnService.buyTiUSDPersonalProportion,"1.2-2"),"%"),e.xp6(7),e.hij("",e.xi3(101,60,i.use2earnService.buyTiUSDPersonalRewardRate,"1.4-4")," TiTi"),e.xp6(13),e.hij("",e.xi3(114,63,i.formatTokenValue(i.use2earnService.buyTiUSDEpochTotalAmount.toString(),"18"),"1.2-4")," TiUSD"),e.xp6(7),e.hij("",e.xi3(121,66,i.formatTokenValue(i.use2earnService.buyTiUSDEpochPersonalAmount.toString(),"18"),"1.2-4")," TiUSD"),e.xp6(15),e.Q6J("ngIf",e.lcZ(136,69,i.buyTiUSDRecord$))("ngIfElse",o)}}const E=[{path:"",component:(()=>{class a{constructor(o,i){this.location=o,this.use2earnService=i,this.countDown$=(0,w.H)(0,1e3).pipe((0,S.U)(()=>this.hms(864e5-((new Date).getTime()-288e5)%864e5))),this.buyTiUSDRecord$=this.use2earnService.dailyUserMint$.pipe((0,S.U)(g=>g.map(y=>({time:1e3*y.dailyMint.dayStartTimestamp,personalBuyAmount:y.dailyMint.dailyTotalVolume,totalBuyAmount:y.dailyVolume,confirmedRewards:m.O$.from(y.dailyMint.dailyTotalVolume).mul((0,b.parseUnits)(this.use2earnService.buyTiUSDRewardRate+"","18")).div(m.O$.from(y.dailyVolume)).toString()})).filter(y=>y.time!=864e5*Math.floor(((new Date).getTime()-288e5)/864e5)).sort((y,O)=>O.time-y.time)))}ngOnInit(){}goBack(){this.location.back()}formatTokenValue(o,i){return(0,b.formatUnits)(o,i)}getBuyTiUSDRewardRate(){return this.use2earnService.currentEpochInfo.buyTiUSDReward/10**18*86400/this.use2earnService.currentEpochInfo.duration}hms(o){return o>0?[parseInt(o%864e5/36e5+"")+"h",parseInt(o%36e5/6e4+"")+"m",parseInt(o%6e4/1e3+"")+"s"].join(":"):[" -- h"," -- m"," -- s"].join(":")}}return a.\u0275fac=function(o){return new(o||a)(e.Y36(p.Ye),e.Y36(u.Q))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-buy-tiusd"]],decls:1,vars:1,consts:[["class","buy-tiusd-wrapper",4,"ngIf"],[1,"buy-tiusd-wrapper"],[2,"position","absolute"],["mat-button","","color","primary",1,"back-btn",3,"click"],[1,"page-title",2,"grid-column-start","span 2"],["href","https://blog.titi.finance/use-to-earn-the-first-ever-interest-bearing-stablecoin-tokenomic-design-32486fe7cb54","target","_blank"],[1,"info-card","mat-elevation-z4"],[2,"justify-self","center","grid-column-start","span 2"],[2,"justify-self","start"],[2,"justify-self","end","display","inline-flex","flex-direction","column","justify-content","center","align-items","end","width","100%"],[2,"justify-self","end"],["text","$TiTi Rewards distribution to all TiUSD Buyers calculated on a daily basis."],[1,"golden-highlight",2,"justify-self","start"],["text","$TiTi Rewards you've earned buying TiUSD in TiTi-AMMs."],[1,"golden-highlight",2,"justify-self","end"],["text","Estimated $TiTi Token you earned buying TiUSD on a daily basis. It's variable because it's calculated per seconds. The settlement and re-calculation  time is UTC 8:00:00 everyday."],["text","The tAPY(token APY) is based on $TiTi oracle price, current Epoch's rewards rate and your TiUSD buy amount against all TiUSD buyers."],["text"," Estimated value based on pending rewards today."],["text","Estimated APY calculated based on distributed $TiTi Rewards to TiUSD buyers from current Epoch starting Time."],[2,"justify-self","center","grid-column-start","span 2","position","relative","display","flex","justify-content","center","align-items","center"],[2,"height","90px","width","90px","display","flex","justify-content","center","align-items","center"],["color","warn","mode","determinate",2,"position","absolute",3,"value"],["color","primary","mode","determinate",2,"position","absolute",3,"value"],[1,"percentage-description",2,"justify-self","center","grid-column-start","span 2","font-size","1rem","width","100%","text-align","center"],[1,"golden-highlight"],["routerLink","/swap",1,"btn"],[1,"info-card","mat-elevation-z4",2,"grid-template-rows","auto auto auto auto 1fr"],["text","All user's TiUSD buy amount from the current Epoch starting time. The Buy amount today isn't included."],["text","Your TiUSD buy amount from the current Epoch starting time. The Buy amount today isn't included."],[2,"font-size","0.5vw","justify-self","center","align-self","start","grid-column-start","span 2","display","grid","grid-template-columns","1fr 1fr 1fr 1fr","column-gap","4px","row-gap","1rem","justify-items","center","align-items","center"],[1,"divider",2,"justify-self","center","grid-column-start","span 4"],[2,"width","100%","justify-self","center","align-self","start","grid-column-start","span 4","display","grid","grid-template-columns","1fr 1fr 1fr 1fr","column-gap","4px","row-gap","1rem","justify-items","center","align-items","center","max-height","30vh","overflow-y","scroll"],[4,"ngIf","ngIfElse"],["noDataTemplate",""],[4,"ngFor","ngForOf"],[4,"ngIf"]],template:function(o,i){1&o&&e.YNc(0,Z,139,71,"div",0),2&o&&e.Q6J("ngIf",i.use2earnService.currentEpochInfo)},directives:[p.O5,c.lW,B.Q,D.Ou,h.rH,p.sg],pipes:[p.uU,p.JJ,p.Ov],styles:[".buy-tiusd-wrapper[_ngcontent-%COMP%]{padding:24px;display:grid;grid-template-columns:1fr 1fr;grid-column-gap:2vw;column-gap:2vw;grid-row-gap:2vw;row-gap:2vw}.back-btn[_ngcontent-%COMP%]{text-decoration:underline}.info-card[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:auto auto;grid-row-gap:1rem;row-gap:1rem;align-items:center}.btn[_ngcontent-%COMP%]{border:2px solid #ffd748;color:#ffd748;padding:1rem;font-weight:bolder;border-radius:2rem;justify-self:center;grid-column-start:span 2;cursor:pointer;-webkit-background-clip:text;background-clip:text;background-image:linear-gradient(180deg,#e6b7ff,#ffd95b,#ffd22f,#d7abff 75%,transparent);-webkit-text-fill-color:transparent;box-shadow:0 0 6px 4px #fffa9700}.btn[_ngcontent-%COMP%]:hover{border:2px solid #ffc71d;color:#ffc71d;background-image:linear-gradient(180deg,#d483ff,#fdd75a,#ffbf00,#bf7bff 75%,transparent);box-shadow:0 0 6px 4px #fffa974d}.titi-dark-theme[_nghost-%COMP%]   .btn[_ngcontent-%COMP%], .titi-dark-theme   [_nghost-%COMP%]   .btn[_ngcontent-%COMP%]{border:2px solid #fdff79;color:#fdff79;-webkit-background-clip:text;background-clip:text;background-image:linear-gradient(180deg,#e6b7ff,#ffe48c,#ffd058,#d7abff 75%,transparent);-webkit-text-fill-color:transparent;box-shadow:0 0 6px 4px #fffa9700;-webkit-backdrop-filter:brightness(.9);backdrop-filter:brightness(.9)}.titi-dark-theme[_nghost-%COMP%]   .btn[_ngcontent-%COMP%]:hover, .titi-dark-theme   [_nghost-%COMP%]   .btn[_ngcontent-%COMP%]:hover{border:2px solid #f8faad;color:#f8faad;background-image:linear-gradient(180deg,#d483ff,#fdd75a,#ffb700,#bf7bff 75%,transparent);box-shadow:0 0 6px 4px #fffa974d;-webkit-backdrop-filter:brightness(1.5);backdrop-filter:brightness(1.5)}.titi-dark-theme[_nghost-%COMP%]   .percentage-description[_ngcontent-%COMP%], .titi-dark-theme   [_nghost-%COMP%]   .percentage-description[_ngcontent-%COMP%]{color:#7bffc1}"]}),a})()}];let I=(()=>{class a{}return a.\u0275fac=function(o){return new(o||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[[h.Bz.forChild(E)],h.Bz]}),a})();var f=n(45922),x=n(87841);let t=(()=>{class a{}return a.\u0275fac=function(o){return new(o||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[[p.ez,I,f.F,c.ot,D.Cq,x.m]]}),a})()},32681:(C,_,n)=>{n.d(_,{Q:()=>I});var p=n(15861),h=n(57959),b=n(94528),w=n(57424),S=n(32856),m=n(98538),e=n.n(m),u=n(52909),c=n(48634),D=n(61135),v=n(5963),M=n(54004),U=n(5e3),P=n(57610),Z=n(53405),$=n(11730),E=n(65707);let I=(()=>{class f{constructor(t,a,d,o){this.accountService=t,this.graphService=a,this.web3Service=d,this.chainInfoService=o,this.buyTiUSDReward=0,this.buyTiUSDPersonalReward=0,this.buyTiUSDRewardRate=0,this.buyTiUSDPersonalRewardRate=0,this.buyTiUSDTotalAmount=0,this.buyTiUSDPersonalAmount=0,this.buyTiUSDPersonalProportion=0,this.buyTiUSDAvgApy=0,this.buyTiUSDDailyApy=0,this.buyTiUSDEpochPersonalAmount=u.O$.from("0"),this.buyTiUSDEpochTotalAmount=u.O$.from("0"),this.holdTiUSDReward=0,this.holdTiUSDPersonalReward=0,this.holdTiUSDRewardRate=0,this.holdTiUSDPersonalRewardRate=0,this.holdTotalTiUSDAmount="0",this.holdTiUSDBalance="0",this.holdTiUSDApy=0,this.buyTiTiReward=0,this.buyTiTiPersonalReward=0,this.buyTiTiRewardRate=0,this.buyTiTiPersonalRewardRate=0,this.buyTiTiPersonalAmount=0,this.buyTiTiTotalAmount=0,this.buyTiTiEpochPersonalAmount=u.O$.from("0"),this.buyTiTiEpochTotalAmount=u.O$.from("0"),this.buyTiTiPersonalProportion=0,this.buyTiTiAvgApy=0,this.buyTiTiDailyApy=0,this.totalClaimableRewards=0,this.distributedTiTiRewards=0,this.top20Users$=new D.X([]),this.dailyUserMint$=new D.X([]),this.dailyUserSwap$=new D.X([]),this.APIURL="https://api.thegraph.com/subgraphs/name/titimainnet/titi-use-to-earn",this.client=new h.f({uri:this.APIURL,cache:new b.h}),this.chainInfoService.currentChainId$.subscribe(i=>{this.setNewApi(this.chainInfoService.getChainConfig(i).use2earnApi)}),(0,v.H)(2e3,1e4).pipe((0,M.U)(()=>this.fetchUserData())).subscribe()}getNewBuyTiUSDPersonalProportion(t){return u.O$.from(this.buyTiUSDPersonalAmount).add((0,c.parseUnits)(t+"","18")).mul(u.O$.from("10000")).div(u.O$.from(this.buyTiUSDTotalAmount).add((0,c.parseUnits)(t+"","18"))).toNumber()/100}getNewbuyTiUSDPersonalRewardRate(t){return this.getNewBuyTiUSDPersonalProportion(t)*this.buyTiUSDRewardRate/100}getExpectedDailyRewards(t){return u.O$.from(this.holdTotalTiUSDAmount).isZero()?0:this.holdTiUSDRewardRate*(u.O$.from(t).mul(u.O$.from("10000")).div(u.O$.from(this.holdTotalTiUSDAmount)).toNumber()/1e4)}setNewApi(t){this.client.setLink(new w.u({uri:t}))}fetchUserData(){var t=this;return Promise.all([this.web3Service.invokeContract("TiTiUse2EarnBackendV1","getCurrentEpochInfo",["0"]),this.web3Service.invokeContract("TiTiUse2EarnBackendV1","getCurrentEpochInfo",["1"]),this.web3Service.invokeContract("TiTiUse2EarnBackendV1","getCurrentEpochInfo",["2"])]).then(([a,d,o])=>(this.currentEpochInfo={epochNum:a[0],duration:a[2],starttime:a[3],holdTiUSDReward:a[1],buyTiTiReward:o[1],buyTiUSDReward:d[1],totalRewards:u.O$.from(a[1]).add(u.O$.from(o[1])).add(u.O$.from(d[1])).toString()},this.currentEpochInfo)).then(function(){var a=(0,p.Z)(function*({epochNum:d,duration:o,starttime:i,holdTiUSDReward:g,buyTiTiReward:y,buyTiUSDReward:O}){const s=1e3*i,T=o/86400,V=parseFloat((0,c.formatUnits)(O,"18")),L=parseFloat((0,c.formatUnits)(g,"18")),j=parseFloat((0,c.formatUnits)(y,"18"));t.buyTiUSDReward=V,t.buyTiUSDRewardRate=(new Date).getTime()<s||(new Date).getTime()>s+1e3*o?0:V/T,t.holdTiUSDReward=L,t.holdTiUSDRewardRate=(new Date).getTime()<s||(new Date).getTime()>s+1e3*o?0:L/T,t.buyTiTiReward=j,t.buyTiTiRewardRate=(new Date).getTime()<s||(new Date).getTime()>s+1e3*o?0:j/T;const A=yield t.fetchTiTiPrice();return t.fetchUserDailyData(d,s,s+1e3*o).then(({data:r})=>{t.buyTiUSDPersonalReward=0,t.holdTiUSDPersonalReward=0,t.buyTiTiPersonalReward=0,t.buyTiUSDPersonalRewardRate=0,t.holdTiUSDPersonalRewardRate=0,t.buyTiTiPersonalRewardRate=0,t.buyTiUSDEpochPersonalAmount=u.O$.from("0"),t.buyTiUSDEpochTotalAmount=u.O$.from("0"),t.buyTiTiEpochPersonalAmount=u.O$.from("0"),t.buyTiTiEpochTotalAmount=u.O$.from("0");const k=Math.floor(((new Date).getTime()-288e5)/864e5),q=Math.floor((s-288e5)/864e5);function W(){let l;const R=(new Date).getTime();return l=R<s?s:R<s+24*T*3600*1e3?R:s+24*T*3600*1e3,l/1e3}r.dailySwaps.forEach(l=>{1e3*(l.dayStartTimestamp+28800)>=s&&1e3*(l.dayStartTimestamp+28800)<s+24*T*3600*1e3&&(t.buyTiTiEpochTotalAmount=t.buyTiTiEpochTotalAmount.add(u.O$.from(l.dailyTotalVolume)))}),r.dailyMints.forEach(l=>{1e3*(l.dayStartTimestamp+28800)>=s&&1e3*(l.dayStartTimestamp+28800)<s+24*T*3600*1e3&&(t.buyTiUSDEpochTotalAmount=t.buyTiUSDEpochTotalAmount.add(u.O$.from(l.dailyTotalVolume)))}),t.buyTiUSDTotalAmount=(new Date).getTime()<s+24*T*3600*1e3&&r.dailyMint&&r.dailyMint.dailyTotalVolume?r.dailyMint.dailyTotalVolume:0,t.buyTiTiTotalAmount=(new Date).getTime()<s+24*T*3600*1e3&&r.dailySwap&&r.dailySwap.dailyTotalVolume?r.dailySwap.dailyTotalVolume:0,t.buyTiUSDDailyApy=t.buyTiUSDTotalAmount>0?t.buyTiUSDRewardRate*A*365/(t.buyTiUSDTotalAmount/10**18):0,t.buyTiUSDAvgApy=t.buyTiUSDEpochTotalAmount.isZero()?0:t.buyTiUSDRewardRate*A*365/(t.buyTiUSDEpochTotalAmount.div(u.O$.from(10**14)).toNumber()/1e3/(k-q)),t.buyTiTiDailyApy=t.buyTiTiTotalAmount>0?t.buyTiTiRewardRate*A*365/(t.buyTiTiTotalAmount/10**18):0,t.buyTiTiAvgApy=t.buyTiTiEpochTotalAmount.isZero()?0:t.buyTiTiRewardRate*A*365/(t.buyTiTiEpochTotalAmount.div(u.O$.from(10**14)).toNumber()/1e3/(k-q)),t.holdTotalTiUSDAmount=r.holder.totalSupply,t.holdTiUSDApy=t.holdTiUSDRewardRate*A*365/(r.holder.totalSupply/10**18),r.user&&(t.dailyUserMint$.next(r.user.dailyUserMint),t.dailyUserSwap$.next(r.user.dailyUserSwap),r.user.dailyUserMint.forEach(l=>{1e3*(l.dailyMint.dayStartTimestamp+28800)>=s&&1e3*(l.dailyMint.dayStartTimestamp+28800)<s+24*T*3600*1e3&&(t.buyTiUSDPersonalReward+=t.buyTiUSDRewardRate*l.dailyVolume/l.dailyMint.dailyTotalVolume,t.buyTiUSDEpochPersonalAmount=t.buyTiUSDEpochPersonalAmount.add(u.O$.from(l.dailyVolume)))}),t.holdTiUSDBalance=r.user.balance,t.holdTiUSDPersonalReward=parseFloat((0,c.formatUnits)(new(e())(r.epochUser?r.epochUser.rewards:"0").add(new(e())(r.user.balance).mul(function(l){if(0===Number.parseInt(l.totalSupply))return new(e())(l.rewardPerTokenStored);const R=new(e())(W()-1*l.lastUpdateTime).mul(new(e())(g)).mul(new(e())("1000000000000000000")).div(new(e())(l.totalSupply).mul(new(e())(86400)).mul(new(e())(T)));return new(e())(l.rewardPerTokenStored).add(R)}(r.holder).sub(new(e())(r.epochUser?r.epochUser.userRewardPerTokenPaid:"0"))).div(new(e())("10").pow(new(e())("18")))).toString(),"18")),r.user.dailyUserSwap.forEach(l=>{1e3*(l.dailySwap.dayStartTimestamp+28800)>=s&&1e3*(l.dailySwap.dayStartTimestamp+28800)<s+24*T*3600*1e3&&(t.buyTiTiPersonalReward+=t.buyTiTiRewardRate*l.dailyVolume/l.dailySwap.dailyTotalVolume,t.buyTiTiEpochPersonalAmount=t.buyTiTiEpochPersonalAmount.add(u.O$.from(l.dailyVolume)))}),t.buyTiUSDPersonalRewardRate=(new Date).getTime()<s+24*T*3600*1e3&&r.dailyUserMint&&r.dailyUserMint.dailyMint.dailyTotalVolume?t.buyTiUSDRewardRate*r.dailyUserMint.dailyVolume/r.dailyUserMint.dailyMint.dailyTotalVolume:0,t.buyTiUSDPersonalAmount=(new Date).getTime()<s+24*T*3600*1e3&&r.dailyUserMint&&r.dailyUserMint.dailyMint.dailyTotalVolume?r.dailyUserMint.dailyVolume:0,t.buyTiUSDPersonalProportion=(new Date).getTime()<s+24*T*3600*1e3&&r.dailyUserMint&&r.dailyUserMint.dailyMint.dailyTotalVolume?r.dailyUserMint.dailyVolume/r.dailyUserMint.dailyMint.dailyTotalVolume*100:0,t.buyTiTiPersonalRewardRate=(new Date).getTime()<s+24*T*3600*1e3&&r.dailyUserSwap&&r.dailyUserSwap.dailySwap.dailyTotalVolume?t.buyTiTiRewardRate*(r.dailyUserSwap.dailyVolume/10**18)/(r.dailyUserSwap.dailySwap.dailyTotalVolume/10**18):0,t.buyTiTiPersonalAmount=(new Date).getTime()<s+24*T*3600*1e3&&r.dailyUserSwap&&r.dailyUserSwap.dailySwap.dailyTotalVolume?r.dailyUserSwap.dailyVolume:0,t.buyTiTiPersonalProportion=(new Date).getTime()<s+24*T*3600*1e3&&r.dailyUserSwap&&r.dailyUserSwap.dailySwap.dailyTotalVolume?r.dailyUserSwap.dailyVolume/r.dailyUserSwap.dailySwap.dailyTotalVolume*100:0,t.holdTiUSDPersonalRewardRate=(new Date).getTime()<s+24*T*3600*1e3?t.holdTiUSDRewardRate*r.user.balance/r.holder.totalSupply:0),t.distributedTiTiRewards=(1e3*W()-s)/864e5*(t.buyTiUSDRewardRate+t.holdTiUSDRewardRate+t.buyTiTiRewardRate),t.top20Users$.next(r.users)})});return function(d){return a.apply(this,arguments)}}())}fetchTiTiPrice(){return Promise.all([this.web3Service.invokeContract("UniswapV2Pair","getReserves",[]),this.graphService.fetchTodayMMFRewardData(this.chainInfoService.getChainConfig().contractAddressMap.MAMMSwapPair)]).then(t=>t[0][1]/t[0][0]*(t[1].data.pair.fund1*10**12/t[1].data.pair.fund0))}fetchUserDailyData(t,a,d){return this.accountService.getCurrentAccountAsyn().then(i=>this.client.query({query:(0,S.Ps)("\n    query($userId: ID,$epochUserId: ID,$epochId:ID,$dayId:ID,$startDayId:ID,$endDayId:ID,$startId:ID,$endId:ID,$todayId:ID) {\n      epochUser(id:$epochUserId){\n        userRewardPerTokenPaid\n        rewards\n      }\n      users(first:20,orderBy:balance,orderDirection:desc){\n        address\n        balance\n      }\n      user(id:$userId){\n        id\n        address\n        balance\n        dailyUserTransfer(first:1000,where:{id_gte:$startDayId,id_lte:$endDayId}){\n          dailyTransfer{\n            dayStartTimestamp\n            dailyTotalVolume\n          }\n          dailyVolume\n        }\n        dailyUserMint(first:1000,where:{id_gte:$startDayId,id_lte:$endDayId}){\n          dailyMint{\n            dayStartTimestamp\n            dailyTotalVolume\n          }\n          dailyVolume\n        }\n        dailyUserSwap(first:1000,where:{id_gte:$startDayId,id_lte:$endDayId}){\n          dailySwap{\n            dayStartTimestamp\n            dailyTotalVolume\n          }\n          dailyVolume\n        }\n      }\n      holder(id:$epochId){\n        lastUpdateTime\n        rewardPerTokenStored\n        totalSupply\n      }\n      dailyUserTransfer(id:$dayId){\n        dailyVolume\n        dailyTransfer{\n          dailyTotalVolume\n        }\n      }\n      dailyUserMint(id:$dayId){\n        dailyVolume\n        dailyMint{\n          dailyTotalVolume\n        }\n      }\n      dailyUserSwap(id:$dayId){\n        dailyVolume\n        dailySwap{\n          dailyTotalVolume\n        }\n      }\n      dailySwaps(first:1000,where:{id_gte:$startId,id_lte:$endId}){\n        id\n        dailyTotalVolume\n        dayStartTimestamp\n      }\n      dailyMints(first:1000,where:{id_gte:$startId,id_lte:$endId}){\n        id\n        dailyTotalVolume\n        dayStartTimestamp\n      }\n      dailySwap(id:$todayId){\n        id\n        dailyTotalVolume\n        dayStartTimestamp\n      }\n      dailyMint(id:$todayId){\n        id\n        dailyTotalVolume\n        dayStartTimestamp\n      }\n   }\n  "),variables:{userId:i.toLowerCase(),epochUserId:t+"-0-"+i.toLowerCase(),epochId:t,dayId:i.toLowerCase()+"-"+Math.floor(((new Date).getTime()-288e5)/864e5),startDayId:i.toLowerCase()+"-"+Math.floor((a-288e5)/864e5),endDayId:i.toLowerCase()+"-"+Math.floor((d-288e5)/864e5),startId:Math.floor((a-288e5)/864e5),endId:Math.floor((d-288e5)/864e5),todayId:Math.floor(((new Date).getTime()-288e5)/864e5)},fetchPolicy:"network-only"}))}}return f.\u0275fac=function(t){return new(t||f)(U.LFG(P.B),U.LFG(Z.h),U.LFG($.Uc),U.LFG(E.Z))},f.\u0275prov=U.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()}}]);