"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[3905],{13905:(K,h,r)=>{r.r(h),r.d(h,{Use2earnModule:()=>X});var T=r(69808),m=r(71787),f=r(98538),c=r.n(f),p=r(48634),u=r(28321),e=r(5e3),v=r(32681),U=r(31657),C=r(48966),w=r(11730),Z=r(57610),y=r(65707),b=r(92134),g=r(47423),o=r(32075),S=r(63874),R=r(75303);function A(t,n){1&t&&(e.TgZ(0,"th",23),e._uU(1,"Act."),e.qZA())}function D(t,n){if(1&t&&(e.TgZ(0,"td",24),e.TgZ(1,"div",25),e.TgZ(2,"span"),e._uU(3),e.qZA(),e.TgZ(4,"mat-icon",26),e._uU(5," north_west"),e.qZA(),e.qZA(),e.qZA()),2&t){const i=n.$implicit;e.xp6(3),e.Oqu(i.act)}}function _(t,n){1&t&&(e.TgZ(0,"th",27),e._uU(1,"Total Rewards"),e.qZA())}function x(t,n){if(1&t&&(e.TgZ(0,"td",28),e._uU(1),e.ALo(2,"numberFormat"),e.qZA()),2&t){const i=n.$implicit;e.xp6(1),e.hij("",e.xi3(2,1,i.total,2)," TiTi")}}function P(t,n){1&t&&(e.TgZ(0,"th",27),e._uU(1,"Distributed Rewards"),e.qZA())}function M(t,n){if(1&t&&(e.TgZ(0,"td",28),e._uU(1),e.ALo(2,"numberFormat"),e.qZA()),2&t){const i=n.$implicit;e.xp6(1),e.hij("",e.xi3(2,1,i.personal,2)," TiTi")}}function O(t,n){1&t&&(e.TgZ(0,"th",27),e._uU(1,"TiTi Rewards tAPY"),e.qZA())}function Y(t,n){if(1&t&&(e.TgZ(0,"td",29),e._uU(1),e.qZA()),2&t){const i=n.$implicit;e.xp6(1),e.Oqu(i.apy)}}function q(t,n){1&t&&e._UZ(0,"tr",30)}function N(t,n){if(1&t){const i=e.EpF();e.TgZ(0,"tr",31),e.NdJ("click",function(){const s=e.CHM(i).$implicit;return e.oxw().onRowClick(s)}),e.qZA()}}function Q(t,n){1&t&&(e.TgZ(0,"th",23),e._uU(1,"Act."),e.qZA())}function $(t,n){if(1&t&&(e.TgZ(0,"td",24),e.TgZ(1,"div",25),e.TgZ(2,"span"),e._uU(3),e.qZA(),e.TgZ(4,"mat-icon",26),e._uU(5," north_west"),e.qZA(),e.qZA(),e.qZA()),2&t){const i=n.$implicit;e.xp6(3),e.Oqu(i.act)}}function z(t,n){1&t&&(e.TgZ(0,"th",27),e._uU(1,"Total Rewards"),e.qZA())}function B(t,n){if(1&t&&(e.TgZ(0,"td",28),e._uU(1),e.ALo(2,"numberFormat"),e.qZA()),2&t){const i=n.$implicit;e.xp6(1),e.hij("",e.xi3(2,1,i.total,2)," TiTi")}}function F(t,n){1&t&&(e.TgZ(0,"th",27),e._uU(1,"Distributed Rewards"),e.qZA())}function I(t,n){if(1&t&&(e.TgZ(0,"td",28),e._uU(1),e.ALo(2,"numberFormat"),e.qZA()),2&t){const i=n.$implicit;e.xp6(1),e.hij("",e.xi3(2,1,i.personal,2)," TiTi")}}function k(t,n){1&t&&(e.TgZ(0,"th",27),e._uU(1,"TiTi Rewards tAPY"),e.qZA())}function L(t,n){if(1&t&&(e.TgZ(0,"td",29),e._uU(1),e.qZA()),2&t){const i=n.$implicit;e.xp6(1),e.Oqu(i.apy)}}function j(t,n){1&t&&e._UZ(0,"tr",30)}function J(t,n){if(1&t){const i=e.EpF();e.TgZ(0,"tr",31),e.NdJ("click",function(){const s=e.CHM(i).$implicit;return e.oxw().onRowClick(s)}),e.qZA()}}const H=[{path:"",component:(()=>{class t{constructor(i,a,l,s,d,G,W){this.router=i,this.use2earnService=a,this.refreshService=l,this.dialog=s,this.web3Service=d,this.accountService=G,this.chainInfoService=W,this.isLoading=!1,this.displayedColumns=["act","total","personal","apy"],this.dataSource1=[],this.dataSource2=[],this.claimedRewards="0",this.totalClaimable="0",this.userDistributedReward=0,this.proof=[],this.totalDistributeReward=0,this.clickedRows=new Set}get claimableRewards(){let i=0;try{i=new(c())(this.totalClaimable).sub(new(c())(this.claimedRewards)).mul(new(c())("10000")).div(new(c())("10").pow(new(c())("18"))).toNumber()/1e4}catch(a){}return i<0?0:i}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){this.fetchUserData().then(()=>this.buildDataSource()),this.fetchTotalDistributedReward().then(()=>this.fetchTreeData()).then(()=>this.fetchClaimedRewards())}fetchClaimedRewards(){return this.accountService.getCurrentAccountAsyn().then(i=>this.web3Service.invokeContract("TiTiMerkleDistributor","claimed",[i])).then(i=>{this.claimedRewards=i[0]})}fetchUserData(){return this.use2earnService.fetchUserData()}fetchTreeData(){return this.accountService.getCurrentAccountAsyn().then(i=>fetch(`https://api.titi.finance/use2earn/userData?address=${i}&chainId=${this.chainInfoService.currentChainId}`).then(a=>a.json()).then(({latest_reward:l,proof:s,distributed_reward:d})=>{this.totalClaimable=l,this.userDistributedReward=parseFloat((0,p.formatUnits)(d,"18")),this.proof=s?JSON.parse(s):[]}))}fetchTotalDistributedReward(){return fetch(`https://api.titi.finance/use2earn/totalDistributeReward?chainId=${this.chainInfoService.currentChainId}`).then(i=>i.json()).then(({totalDistributeReward:i})=>this.totalDistributeReward=parseFloat((0,p.formatUnits)(i,"18")))}buildDataSource(){this.dataSource1=[{act:"Buy TiUSD in TiTi-AMMs (Swap)",total:this.use2earnService.buyTiUSDReward,personal:this.use2earnService.buyTiUSDPersonalReward-this.use2earnService.buyTiUSDPersonalRewardRate>0?this.use2earnService.buyTiUSDPersonalReward-this.use2earnService.buyTiUSDPersonalRewardRate:0,rate:this.use2earnService.buyTiUSDPersonalRewardRate,apy:`Daily ${(0,u.QV)(100*this.use2earnService.buyTiUSDDailyApy)}%\nAvg ${(0,u.QV)(100*this.use2earnService.buyTiUSDAvgApy)}%`,url:"/use2earn/buyTiUSD"},{act:"TiUSD Holder",total:this.use2earnService.holdTiUSDReward,personal:this.use2earnService.holdTiUSDPersonalReward,rate:this.use2earnService.holdTiUSDPersonalRewardRate,apy:`${(0,u.QV)(100*this.use2earnService.holdTiUSDApy)}%`,url:"/use2earn/holdTiUSD"}],this.dataSource2=[{act:`Buy TiTi in TiTi/TiUSD Pair (${this.chainInfoService.getChainConfig().swapDexName})`,total:this.use2earnService.buyTiTiReward,personal:this.use2earnService.buyTiTiPersonalReward-this.use2earnService.buyTiTiPersonalRewardRate>0?this.use2earnService.buyTiTiPersonalReward-this.use2earnService.buyTiTiPersonalRewardRate:0,rate:this.use2earnService.buyTiTiPersonalRewardRate,apy:`Daily ${(0,u.QV)(100*this.use2earnService.buyTiTiDailyApy)}%\nAvg ${(0,u.QV)(100*this.use2earnService.buyTiTiAvgApy)}%`,url:"/use2earn/buyTiTi"}]}onRowClick(i){this.router.navigateByUrl(i.url)}onClaim(){this.isLoading=!0,r.e(1797).then(r.bind(r,51797)).then(({TitiStakingModalComponent:i})=>{this.dialog.open(i).afterClosed().subscribe(l=>this.accountService.getCurrentAccountAsyn().then(s=>this.web3Service.invokeContract("TiTiMerkleDistributor",l?"claimAndStake":"claim",[this.totalClaimable,this.proof])).then(()=>this.isLoading=!1,()=>this.isLoading=!1))})}}return t.\u0275fac=function(i){return new(i||t)(e.Y36(m.F0),e.Y36(v.Q),e.Y36(U.g),e.Y36(C.uw),e.Y36(w.Uc),e.Y36(Z.B),e.Y36(y.Z))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-use2earn"]],decls:72,vars:20,consts:[[1,"use2earn-wrapper"],[1,"page-title",2,"grid-column-start","span 6"],["href","https://docs.titi.finance/overview/what-is-the-flywheel-of-titi-protocol-use-tiusd-to-earn","target","_blank"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],["text","Accumulative $TiTi Rewards distributed to use-to-earn behaviors."],[1,"value"],["text","Total accumulative use-to-earn  $TiTi Rewards you earned."],["text","Total accumulative, but unclaimed use-to-earn  $TiTi Rewards you earned."],["mat-raised-button","","color","primary",1,"action-btn",3,"disabled","click"],[1,"mat-elevation-z4","activity-table-wrapper"],["mat-table","",1,"activity-table",3,"dataSource"],["matColumnDef","act"],["mat-header-cell","","class"," left-align",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","total"],["mat-header-cell","","class"," right-align",4,"matHeaderCellDef"],["mat-cell","","class"," right-align",4,"matCellDef"],["matColumnDef","personal"],["matColumnDef","apy"],["mat-cell","","class"," right-align","style","line-height:1.5",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"left-align"],["mat-cell",""],[2,"display","flex","justify-content","start","align-items","center"],["color","primary",2,"font-size","1rem","line-height","1rem","height","1rem","margin-left","0.5rem"],["mat-header-cell","",1,"right-align"],["mat-cell","",1,"right-align"],["mat-cell","",1,"right-align",2,"line-height","1.5"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(i,a){1&i&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"h1"),e._uU(3,"Use-To-Earn"),e.qZA(),e.TgZ(4,"p"),e._uU(5,"Use-to-earn is a novel interest-bearing stablecoin tokenomic design. It allows users to earn both passive and positive revenue in a merkle-proof way surrounding TiUSD onchain usage. "),e.TgZ(6,"a",2),e._uU(7,"Click to Learn More"),e.qZA(),e._uU(8,"."),e.qZA(),e.qZA(),e.TgZ(9,"div",3),e.TgZ(10,"h2",4),e._uU(11,"Distributed TiTi Rewards"),e._UZ(12,"titi-tooltip",5),e.qZA(),e.TgZ(13,"span",6),e._uU(14),e.ALo(15,"numberFormat"),e.qZA(),e.qZA(),e.TgZ(16,"div",3),e.TgZ(17,"h2",4),e._uU(18,"Your Distributed Rewards"),e._UZ(19,"titi-tooltip",7),e.qZA(),e.TgZ(20,"span",6),e._uU(21),e.ALo(22,"numberFormat"),e.qZA(),e.qZA(),e.TgZ(23,"div",3),e.TgZ(24,"h2",4),e._uU(25,"Your Claimable Rewards"),e._UZ(26,"titi-tooltip",8),e.qZA(),e.TgZ(27,"span",6),e._uU(28),e.ALo(29,"numberFormat"),e.qZA(),e.TgZ(30,"button",9),e.NdJ("click",function(){return a.onClaim()}),e._uU(31),e.qZA(),e.qZA(),e.TgZ(32,"div",10),e.TgZ(33,"h2"),e._uU(34,"Internal-Protocol Incentive Actions"),e.qZA(),e.TgZ(35,"h3"),e._uU(36,"Incentivize key behaviors within the protocol."),e.qZA(),e.TgZ(37,"table",11),e.ynx(38,12),e.YNc(39,A,2,0,"th",13),e.YNc(40,D,6,1,"td",14),e.BQk(),e.ynx(41,15),e.YNc(42,_,2,0,"th",16),e.YNc(43,x,3,4,"td",17),e.BQk(),e.ynx(44,18),e.YNc(45,P,2,0,"th",16),e.YNc(46,M,3,4,"td",17),e.BQk(),e.ynx(47,19),e.YNc(48,O,2,0,"th",16),e.YNc(49,Y,2,1,"td",20),e.BQk(),e.YNc(50,q,1,0,"tr",21),e.YNc(51,N,1,0,"tr",22),e.qZA(),e.qZA(),e.TgZ(52,"div",10),e.TgZ(53,"h2"),e._uU(54,"External-Protocol Incentive Actions"),e.qZA(),e.TgZ(55,"h3"),e._uU(56,"Incentivize key behaviors surrounding TiUSD with integrated Protocols."),e.qZA(),e.TgZ(57,"table",11),e.ynx(58,12),e.YNc(59,Q,2,0,"th",13),e.YNc(60,$,6,1,"td",14),e.BQk(),e.ynx(61,15),e.YNc(62,z,2,0,"th",16),e.YNc(63,B,3,4,"td",17),e.BQk(),e.ynx(64,18),e.YNc(65,F,2,0,"th",16),e.YNc(66,I,3,4,"td",17),e.BQk(),e.ynx(67,19),e.YNc(68,k,2,0,"th",16),e.YNc(69,L,2,1,"td",20),e.BQk(),e.YNc(70,j,1,0,"tr",21),e.YNc(71,J,1,0,"tr",22),e.qZA(),e.qZA(),e.qZA()),2&i&&(e.xp6(14),e.hij("",e.xi3(15,11,a.totalDistributeReward+a.use2earnService.distributedTiTiRewards,2)," TiTi"),e.xp6(7),e.hij("",e.xi3(22,14,a.userDistributedReward+(a.use2earnService.buyTiUSDPersonalReward+a.use2earnService.buyTiTiPersonalReward-a.use2earnService.buyTiUSDPersonalRewardRate-a.use2earnService.buyTiTiPersonalRewardRate>0?a.use2earnService.buyTiUSDPersonalReward+a.use2earnService.holdTiUSDPersonalReward+a.use2earnService.buyTiTiPersonalReward-a.use2earnService.buyTiUSDPersonalRewardRate-a.use2earnService.buyTiTiPersonalRewardRate:a.use2earnService.holdTiUSDPersonalReward),4)," TiTi"),e.xp6(7),e.hij("",e.xi3(29,17,a.claimableRewards,4)," TiTi"),e.xp6(2),e.Q6J("disabled",a.claimableRewards<=0||a.isLoading),e.xp6(1),e.Oqu(a.isLoading?"waiting...":"CLAIM"),e.xp6(6),e.Q6J("dataSource",a.dataSource1),e.xp6(13),e.Q6J("matHeaderRowDef",a.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",a.displayedColumns),e.xp6(6),e.Q6J("dataSource",a.dataSource2),e.xp6(13),e.Q6J("matHeaderRowDef",a.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",a.displayedColumns))},directives:[b.Q,g.lW,o.BZ,o.w1,o.fO,o.Dz,o.as,o.nj,o.ge,o.ev,S.Hw,o.XQ,o.Gk],pipes:[R.p],styles:[".mat-row[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{border-bottom:1px solid transparent;border-top:1px solid transparent;cursor:pointer}.mat-row[_ngcontent-%COMP%]:hover   .mat-cell[_ngcontent-%COMP%]{border-color:#1de9b6}.mat-cell[_ngcontent-%COMP%]{width:24%;font-size:max(.6rem,12px);white-space:pre}.mat-column-act[_ngcontent-%COMP%]{width:28%}.use2earn-wrapper[_ngcontent-%COMP%]{padding:12px;display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr 1fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:2rem;row-gap:2rem}.biz-info-card[_ngcontent-%COMP%]{min-height:120px;padding:18px;grid-column-start:span 2;display:grid;grid-template-columns:1fr 1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 4;margin-left:12px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 3;align-self:end;font-size:18px;margin-left:12px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.activity-table-wrapper[_ngcontent-%COMP%]{grid-column-start:span 3;padding:12px;display:flex;align-items:center;flex-direction:column;min-height:360px}.activity-table[_ngcontent-%COMP%]{width:100%;background-color:transparent}.activity-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .activity-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:0 4px}.activity-table[_ngcontent-%COMP%]   .left-align[_ngcontent-%COMP%]{text-align:left}.activity-table[_ngcontent-%COMP%]   .right-align[_ngcontent-%COMP%]{text-align:right}@media screen and (max-width: 1024px){.use2earn-wrapper[_ngcontent-%COMP%]{width:100%;padding:12px;margin:0;display:grid;grid-template-columns:1fr;grid-row-gap:1rem;row-gap:1rem;grid-column-gap:0;column-gap:0}.biz-info-card[_ngcontent-%COMP%]{width:100%;margin:0;min-height:80px;grid-column-start:span 1}.activity-table-wrapper[_ngcontent-%COMP%]{width:100%;margin:0;padding:12px;grid-column-start:span 1}}"]}),t})()}];let V=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[m.Bz.forChild(H)],m.Bz]}),t})();var E=r(87841);let X=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[T.ez,V,o.p0,g.ot,E.m]]}),t})()}}]);