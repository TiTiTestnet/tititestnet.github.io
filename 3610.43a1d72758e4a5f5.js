"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[3610],{83610:(N,g,n)=>{n.r(g),n.d(g,{ReordersModule:()=>L});var p=n(69808),m=n(71787),u=n(17489),T=n(5963),R=n(54004),A=n(28321),t=n(5e3),O=n(11730),M=n(53405),x=n(74696),y=n(31657),U=n(92134),f=n(4834),c=n(26688),v=n(20773),C=n(11523),P=n(75303);function w(i,s){if(1&i&&(t.ynx(0),t.TgZ(1,"span",19),t._uU(2),t.qZA(),t.TgZ(3,"span",20),t._uU(4),t.ALo(5,"numberFormat"),t.qZA(),t.BQk()),2&i){const e=s.$implicit,r=s.index,o=t.oxw();t.xp6(2),t.hij("TiUSD-",e,":"),t.xp6(2),t.hij("$ ",t.xi3(5,2,o.currentPrices[r],4),"")}}let S=(()=>{class i{constructor(e,r,o,a){this.web3Service=e,this.graphService=r,this.echartService=o,this.refreshService=a,this.futureString="January 1, 2023 12:00:00",this.countdown=100,this.lastReOrdersTime=0,this.duration=0,this.lastReordersCondition="-",this.reserveNames=[],this.currentPrices=[],this.dailyPrices=[],this.totalReserve=0,this.currentReserveRatio=[],this.option1={},this.option2={}}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){Promise.all([this.fetchLastReOrdersData(),this.fetchReOrdersDuration()]).then(()=>this.calcCountdown()),Promise.all([this.fetchReserves(),this.fetchOptions()]).then(()=>{this.buildOption()})}buildOption(){this.option1.series=Array(this.reserveNames.length).fill(null).map((e,r)=>({name:"TiUSD-"+this.reserveNames[r],type:"line",stack:"total",label:{show:!1},emphasis:{focus:"series"},data:this.dailyPrices[r]})),this.option1.series[0]&&(this.option1.series[0].markLine={lineStyle:{color:"#01fef9"},symbol:["circle","none"],data:[{name:"$ 1.00",yAxis:1},{name:"$ 0.95",yAxis:.95},{name:"$ 1.05",yAxis:1.05}],label:{formatter:"${c}",color:"#01fef9",position:"start"}}),this.option2.series[0].data=Array(this.reserveNames.length).fill(null).map((e,r)=>({name:this.reserveNames[r],value:this.currentReserveRatio[r]})),this.option1=(0,u.cloneDeep)(this.option1),this.option2=(0,u.cloneDeep)(this.option2)}fetchOptions(){return Promise.all([this.echartService.fetchOption("TiUSD-TWAP"),this.echartService.fetchOption("TiUSD-Reserve-Pie")]).then(e=>{this.option1=e[0],this.option2=e[1]})}calcCountdown(){this.future=new Date(1e3*(1*this.lastReOrdersTime+1*this.duration)),this.counter$=(0,T.H)(0,1e3).pipe((0,R.U)(()=>{const e=this.future.getTime()-(new Date).getTime();return this.countdown=Number.parseInt(100*e/(1e3*this.duration)+""),this.dhms(e)}))}dhms(e){return e>0?[parseInt(e/864e5+"")+"d",parseInt(e%864e5/36e5+"")+"h",parseInt(e%36e5/6e4+"")+"m",parseInt(e%6e4/1e3+"")+"s"].join(":"):["00d","00h","00m","00s"].join(":")}fetchLastReOrdersData(){return this.graphService.fetchLastReOrdersData().then(({data:e})=>{e.reOrders[0]&&(this.lastReOrdersTime=e.reOrders[0].lastReordersTime,this.lastReordersCondition=D[e.reOrders[0].reordersCondition])})}fetchReOrdersDuration(){return this.web3Service.invokeContract("ReOrdersController","duration",[]).then(e=>{this.duration=e[0]})}fetchMMFFund(){return this.web3Service.invokeContract("MAMMSwapPair","getMMFFunds",[]).then(e=>{this.totalReserve=e[1]/10**6})}fetchReserves(){this.fetchMMFFund().then(()=>this.graphService.fetchAllSwapPairDailyData().then(({data:e})=>{const r=e.pairs;this.reserveNames=[],this.currentPrices=[],this.dailyPrices=[],this.currentReserveRatio=[],r.forEach(o=>{this.currentReserveRatio.push(this.totalReserve),this.reserveNames.push(o.token1.symbol),this.currentPrices.push(o.token0Twap/10**18);const a=Array(720).fill(null),h=(0,A.jn)().reverse();o.pairHourData.forEach(d=>{const l=h.indexOf(1e3*d.hourStartTimestamp);-1!==l&&(a[l]=d.token0Twap/10**18)});let Z=1;a.forEach((d,l)=>{null===d?a[l]=Z:Z=d}),this.dailyPrices.push(a)})}))}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(O.Uc),t.Y36(M.h),t.Y36(x.p),t.Y36(y.g))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-reorders"]],decls:59,vars:17,consts:[[1,"reorders-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],["text","Timestamp of last ReOrders"],[1,"value"],["text","The last condition that triggered ReOrders. At present, there are three triggering conditions, including:\n      \xb7 Time Interval;\n      \xb7 Price Spread;\n      \xb7 MMF Update;"],[1,"countdown-info-card","mat-elevation-z4"],[1,"pool-info-title"],["text","The protocol sets a fixed time condition to trigger the Reorders.The initial parameter is set at 12 hours and subject to future adjustment."],[2,"grid-column-start","1","grid-column-end","3","display","grid","grid-template-columns","2fr 3fr 2fr","align-items","center"],[2,"justify-self","center"],[1,"pool-chart"],["mode","determinate",3,"value","diameter"],[1,"pool-info-card","mat-elevation-z4"],["text","The protocol sets a price spread condition to trigger the Reorders. When TiUSD TWAP in one M-AMM deviates 10% from the $1, the Reorders will be triggered. The initial price spread parameter is set at 10% and subject to future adjustment."],[4,"ngFor","ngForOf"],[1,"pool-chart",2,"width","100%","height","100%"],[2,"width","100%","height","100%",3,"option"],["text","When any user join or exit MMF, the Reorders will be triggered automatically."],[2,"justify-self","start"],[2,"justify-self","end"],[2,"grid-column-start","1","grid-column-end","3","display","grid","grid-template-columns","1fr 3fr 1fr","align-items","center"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3,"Last ReOrders Time"),t._UZ(4,"titi-tooltip",3),t.qZA(),t.TgZ(5,"span",4),t._uU(6),t.ALo(7,"date"),t.qZA(),t.qZA(),t.TgZ(8,"div",1),t.TgZ(9,"h2",2),t._uU(10,"Last ReOrders Condition"),t._UZ(11,"titi-tooltip",5),t.qZA(),t.TgZ(12,"span",4),t._uU(13),t.qZA(),t.qZA(),t.TgZ(14,"div",6),t.TgZ(15,"h2",7),t._uU(16,"Time Interval"),t._UZ(17,"titi-tooltip",8),t.qZA(),t.TgZ(18,"div",9),t._UZ(19,"mat-divider"),t.TgZ(20,"mat-chip-list",10),t.TgZ(21,"mat-chip"),t._uU(22,"Count Down"),t.qZA(),t.qZA(),t._UZ(23,"mat-divider"),t.qZA(),t.TgZ(24,"div",11),t._UZ(25,"mat-progress-spinner",12),t.qZA(),t.TgZ(26,"h2",7),t._uU(27),t.ALo(28,"async"),t.qZA(),t.qZA(),t.TgZ(29,"div",13),t.TgZ(30,"h2",7),t._uU(31,"Price Spread"),t._UZ(32,"titi-tooltip",14),t.qZA(),t.YNc(33,w,6,5,"ng-container",15),t.TgZ(34,"div",9),t._UZ(35,"mat-divider"),t.TgZ(36,"mat-chip-list",10),t.TgZ(37,"mat-chip"),t._uU(38,"TiUSD Prices"),t.qZA(),t.qZA(),t._UZ(39,"mat-divider"),t.qZA(),t.TgZ(40,"div",16),t._UZ(41,"titi-chart-wrapper",17),t.qZA(),t.qZA(),t.TgZ(42,"div",13),t.TgZ(43,"h2",7),t._uU(44,"MMF Update"),t._UZ(45,"titi-tooltip",18),t.qZA(),t.TgZ(46,"span",19),t._uU(47,"Total MMF Locked:"),t.qZA(),t.TgZ(48,"span",20),t._uU(49),t.ALo(50,"numberFormat"),t.qZA(),t.TgZ(51,"div",21),t._UZ(52,"mat-divider"),t.TgZ(53,"mat-chip-list",10),t.TgZ(54,"mat-chip"),t._uU(55,"Assets Allocation"),t.qZA(),t.qZA(),t._UZ(56,"mat-divider"),t.qZA(),t.TgZ(57,"div",16),t._UZ(58,"titi-chart-wrapper",17),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.Oqu(t.xi3(7,9,1e3*r.lastReOrdersTime,"y-M-dd HH:mm:ss")),t.xp6(7),t.Oqu(r.lastReordersCondition),t.xp6(12),t.Q6J("value",r.countdown>0?r.countdown:1)("diameter",200),t.xp6(2),t.Oqu(t.lcZ(28,12,r.counter$)),t.xp6(6),t.Q6J("ngForOf",r.reserveNames),t.xp6(8),t.Q6J("option",r.option1),t.xp6(8),t.hij("$ ",t.xi3(50,14,r.totalReserve,4),""),t.xp6(9),t.Q6J("option",r.option2))},directives:[U.Q,f.d,c.qn,c.HS,v.Ou,p.sg,C.o],pipes:[p.uU,p.Ov,P.p],styles:[".reorders-wrapper[_ngcontent-%COMP%]{padding:12px 24px 24px 12px;display:grid;grid-template-columns:2fr 2fr 2fr 2fr 2fr 2fr 0fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:1rem;row-gap:1rem}.biz-info-card[_ngcontent-%COMP%]{min-height:80px;padding:18px;width:100%;grid-column-start:span 3;display:grid;grid-template-columns:1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 3;margin-left:48px;margin-bottom:20px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:end;font-size:18px;margin-left:48px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.countdown-info-card[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:start;justify-self:start;width:100%;height:100%;padding:12px 18px;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:60px 40px auto 60px;grid-row-gap:1rem;row-gap:1rem;align-items:center}.pool-info-card[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:start;justify-self:start;width:100%;height:100%;padding:12px 18px;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:40px 40px 40px auto;grid-row-gap:1rem;row-gap:1rem;align-items:center}.pool-info-title[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3;height:40px;justify-self:center;align-self:start}.pool-chart[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3;justify-self:center}@media screen and (max-width: 1024px){.reorders-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr;width:100%;padding:12px;grid-row-gap:1rem;row-gap:1rem}.biz-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px}.countdown-info-card[_ngcontent-%COMP%], .pool-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;height:auto}}"]}),i})();const D={0:"Time Interval",1:"Price Spread",2:"MMF Update"},F=[{path:"",component:S}];let j=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[m.Bz.forChild(F)],m.Bz]}),i})();var q=n(45922),z=n(87841);let L=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[p.ez,j,f.t,c.Hi,v.Cq,q.F,z.m]]}),i})()}}]);