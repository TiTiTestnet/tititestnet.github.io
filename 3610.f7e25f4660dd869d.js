"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[3610],{92134:(R,h,i)=>{i.d(h,{Q:()=>v});var n=i(5e3),g=i(87238),m=i(63874);let v=(()=>{class l{constructor(){this.color="warn",this.text="",this.position="after"}ngOnInit(){}}return l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=n.Xpm({type:l,selectors:[["titi-tooltip"]],inputs:{color:"color",text:"text",position:"position"},decls:4,vars:4,consts:[["matTooltipHideDelay","200",1,"tooltip-highlight",2,"margin-left","2px",3,"matTooltip","matTooltipPosition","matTooltipClass"],["tooltip","matTooltip"],[2,"font-size","18px","line-height","24px","display","inline","vertical-align","middle",3,"color"]],template:function(t,d){1&t&&(n.TgZ(0,"span",0,1),n.TgZ(2,"mat-icon",2),n._uU(3," help_outline "),n.qZA(),n.qZA()),2&t&&(n.Q6J("matTooltip",d.text)("matTooltipPosition",d.position)("matTooltipClass","titi-tooltip-text"),n.xp6(2),n.Q6J("color",d.color))},directives:[g.gM,m.Hw],styles:[""]}),l})()},83610:(R,h,i)=>{i.r(h),i.d(h,{ReordersModule:()=>I});var n=i(69808),g=i(71787),m=i(17489),v=i(5963),l=i(54004),u=i(28321),t=i(5e3),d=i(11730),M=i(53405),y=i(74696),C=i(31657),P=i(92134),x=i(4834),T=i(26688),A=i(20773),U=i(11523),w=i(75303);function D(o,s){if(1&o&&(t.ynx(0),t.TgZ(1,"span",19),t._uU(2),t.qZA(),t.TgZ(3,"span",20),t._uU(4),t.ALo(5,"numberFormat"),t.qZA(),t.BQk()),2&o){const e=s.$implicit,r=s.index,a=t.oxw();t.xp6(2),t.hij("TiUSD-",e,":"),t.xp6(2),t.hij("$ ",t.xi3(5,2,a.currentPrices[r],4),"")}}let S=(()=>{class o{constructor(e,r,a,p){this.web3Service=e,this.graphService=r,this.echartService=a,this.refreshService=p,this.futureString="January 1, 2023 12:00:00",this.countdown=100,this.lastReOrdersTime=0,this.duration=0,this.lastReordersCondition="-",this.reserveNames=[],this.currentPrices=[],this.dailyPrices=[],this.totalReserve=0,this.currentReserveRatio=[],this.option1={},this.option2={}}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){Promise.all([this.fetchLastReOrdersData(),this.fetchReOrdersDuration()]).then(()=>this.calcCountdown()),Promise.all([this.fetchReserves(),this.fetchOptions()]).then(()=>{this.buildOption()})}buildOption(){this.option1.series=Array(this.reserveNames.length).fill(null).map((e,r)=>({name:"TiUSD-"+this.reserveNames[r],type:"line",stack:"total",label:{show:!1},emphasis:{focus:"series"},data:this.dailyPrices[r]})),this.option1.series[0]&&(this.option1.series[0].markLine={lineStyle:{color:"#01fef9"},symbol:["circle","none"],data:[{name:"$ 1.00",yAxis:1},{name:"$ 0.95",yAxis:.95},{name:"$ 1.05",yAxis:1.05}],label:{formatter:"${c}",color:"#01fef9",position:"start"}}),this.option2.series[0].data=Array(this.reserveNames.length).fill(null).map((e,r)=>({name:this.reserveNames[r],value:this.currentReserveRatio[r]})),this.option1=(0,m.cloneDeep)(this.option1),this.option2=(0,m.cloneDeep)(this.option2)}fetchOptions(){return Promise.all([this.echartService.fetchOption("TiUSD-TWAP"),this.echartService.fetchOption("TiUSD-Reserve-Pie")]).then(e=>{this.option1=e[0],this.option2=e[1]})}calcCountdown(){this.future=new Date(1e3*(1*this.lastReOrdersTime+1*this.duration)),this.counter$=(0,v.H)(0,1e3).pipe((0,l.U)(()=>{const e=this.future.getTime()-(new Date).getTime();return this.countdown=Number.parseInt(100*e/(1e3*this.duration)+""),this.dhms(e)}))}dhms(e){return e>0?[parseInt(e/864e5+"")+"d",parseInt(e%864e5/36e5+"")+"h",parseInt(e%36e5/6e4+"")+"m",parseInt(e%6e4/1e3+"")+"s"].join(":"):["00d","00h","00m","00s"].join(":")}fetchLastReOrdersData(){return this.graphService.fetchLastReOrdersData().then(({data:e})=>{e.reOrders[0]&&(this.lastReOrdersTime=e.reOrders[0].lastReordersTime,this.lastReordersCondition=F[e.reOrders[0].reordersCondition])})}fetchReOrdersDuration(){return this.web3Service.invokeContract("ReOrdersController","duration",[]).then(e=>{this.duration=e[0]})}fetchMMFFund(){return this.web3Service.invokeContract("MAMMSwapPair","getMMFFunds",[]).then(e=>{this.totalReserve=e[1]/10**6})}fetchReserves(){this.fetchMMFFund().then(()=>this.graphService.fetchAllSwapPairDailyData().then(({data:e})=>{const r=e.pairs;this.reserveNames=[],this.currentPrices=[],this.dailyPrices=[],this.currentReserveRatio=[],r.forEach(a=>{this.currentReserveRatio.push(this.totalReserve),this.reserveNames.push(a.token1.symbol),this.currentPrices.push(a.token0Twap/10**18);const p=Array(720).fill(null),Z=(0,u.jn)().reverse();a.pairHourData.forEach(c=>{const f=Z.indexOf(1e3*c.hourStartTimestamp);-1!==f&&(p[f]=c.token0Twap/10**18)});let O=1;p.forEach((c,f)=>{null===c?p[f]=O:O=c}),this.dailyPrices.push(p)})}))}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(d.Uc),t.Y36(M.h),t.Y36(y.p),t.Y36(C.g))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-reorders"]],decls:59,vars:17,consts:[[1,"reorders-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],["text","Timestamp of last ReOrders"],[1,"value"],["text","The last condition that triggered ReOrders. At present, there are three triggering conditions, including:\n      \xb7 Time Interval;\n      \xb7 Price Spread;\n      \xb7 MMF Update;"],[1,"countdown-info-card","mat-elevation-z4"],[1,"pool-info-title"],["text","The protocol sets a fixed time condition to trigger the Reorders.The initial parameter is set at 12 hours and subject to future adjustment."],[2,"grid-column-start","1","grid-column-end","3","display","grid","grid-template-columns","2fr 3fr 2fr","align-items","center"],[2,"justify-self","center"],[1,"pool-chart"],["mode","determinate",3,"value","diameter"],[1,"pool-info-card","mat-elevation-z4"],["text","The protocol sets a price spread condition to trigger the Reorders. When TiUSD TWAP in one M-AMM deviates 10% from the $1, the Reorders will be triggered. The initial price spread parameter is set at 10% and subject to future adjustment."],[4,"ngFor","ngForOf"],[1,"pool-chart",2,"width","100%","height","100%"],[2,"width","100%","height","100%",3,"option"],["text","When any user join or exit MMF, the Reorders will be triggered automatically."],[2,"justify-self","start"],[2,"justify-self","end"],[2,"grid-column-start","1","grid-column-end","3","display","grid","grid-template-columns","1fr 3fr 1fr","align-items","center"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3,"Last ReOrders Time"),t._UZ(4,"titi-tooltip",3),t.qZA(),t.TgZ(5,"span",4),t._uU(6),t.ALo(7,"date"),t.qZA(),t.qZA(),t.TgZ(8,"div",1),t.TgZ(9,"h2",2),t._uU(10,"Last ReOrders Condition"),t._UZ(11,"titi-tooltip",5),t.qZA(),t.TgZ(12,"span",4),t._uU(13),t.qZA(),t.qZA(),t.TgZ(14,"div",6),t.TgZ(15,"h2",7),t._uU(16,"Time Interval"),t._UZ(17,"titi-tooltip",8),t.qZA(),t.TgZ(18,"div",9),t._UZ(19,"mat-divider"),t.TgZ(20,"mat-chip-list",10),t.TgZ(21,"mat-chip"),t._uU(22,"Count Down"),t.qZA(),t.qZA(),t._UZ(23,"mat-divider"),t.qZA(),t.TgZ(24,"div",11),t._UZ(25,"mat-progress-spinner",12),t.qZA(),t.TgZ(26,"h2",7),t._uU(27),t.ALo(28,"async"),t.qZA(),t.qZA(),t.TgZ(29,"div",13),t.TgZ(30,"h2",7),t._uU(31,"Price Spread"),t._UZ(32,"titi-tooltip",14),t.qZA(),t.YNc(33,D,6,5,"ng-container",15),t.TgZ(34,"div",9),t._UZ(35,"mat-divider"),t.TgZ(36,"mat-chip-list",10),t.TgZ(37,"mat-chip"),t._uU(38,"TiUSD Prices"),t.qZA(),t.qZA(),t._UZ(39,"mat-divider"),t.qZA(),t.TgZ(40,"div",16),t._UZ(41,"titi-chart-wrapper",17),t.qZA(),t.qZA(),t.TgZ(42,"div",13),t.TgZ(43,"h2",7),t._uU(44,"MMF Update"),t._UZ(45,"titi-tooltip",18),t.qZA(),t.TgZ(46,"span",19),t._uU(47,"Total MMF Locked:"),t.qZA(),t.TgZ(48,"span",20),t._uU(49),t.ALo(50,"numberFormat"),t.qZA(),t.TgZ(51,"div",21),t._UZ(52,"mat-divider"),t.TgZ(53,"mat-chip-list",10),t.TgZ(54,"mat-chip"),t._uU(55,"Assets Allocation"),t.qZA(),t.qZA(),t._UZ(56,"mat-divider"),t.qZA(),t.TgZ(57,"div",16),t._UZ(58,"titi-chart-wrapper",17),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.Oqu(t.xi3(7,9,1e3*r.lastReOrdersTime,"y-M-dd HH:mm:ss")),t.xp6(7),t.Oqu(r.lastReordersCondition),t.xp6(12),t.Q6J("value",r.countdown>0?r.countdown:1)("diameter",200),t.xp6(2),t.Oqu(t.lcZ(28,12,r.counter$)),t.xp6(6),t.Q6J("ngForOf",r.reserveNames),t.xp6(8),t.Q6J("option",r.option1),t.xp6(8),t.hij("$ ",t.xi3(50,14,r.totalReserve,4),""),t.xp6(9),t.Q6J("option",r.option2))},directives:[P.Q,x.d,T.qn,T.HS,A.Ou,n.sg,U.o],pipes:[n.uU,n.Ov,w.p],styles:[".reorders-wrapper[_ngcontent-%COMP%]{padding:12px 24px 24px 12px;display:grid;grid-template-columns:2fr 2fr 2fr 2fr 2fr 2fr 0fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:24px;row-gap:24px}.biz-info-card[_ngcontent-%COMP%]{min-height:80px;padding:18px;width:100%;grid-column-start:span 3;display:grid;grid-template-columns:1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 3;margin-left:48px;margin-bottom:20px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:end;font-size:18px;margin-left:48px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.countdown-info-card[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:start;justify-self:start;width:100%;height:100%;padding:12px 18px;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:60px 40px auto 60px;grid-row-gap:12px;row-gap:12px;align-items:center}.pool-info-card[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:start;justify-self:start;width:100%;height:100%;padding:12px 18px;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:40px 40px 40px auto;grid-row-gap:12px;row-gap:12px;align-items:center}.pool-info-title[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3;height:40px;justify-self:center;align-self:start}.pool-chart[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3;justify-self:center}@media screen and (max-width: 1024px){.reorders-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr;width:100%;padding:12px;grid-row-gap:12px;row-gap:12px}.biz-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px}.countdown-info-card[_ngcontent-%COMP%], .pool-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;height:auto}}"]}),o})();const F={0:"Time Interval",1:"Price Spread",2:"MMF Update"},j=[{path:"",component:S}];let q=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[g.Bz.forChild(j)],g.Bz]}),o})();var z=i(45922),L=i(87841);let I=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[n.ez,q,x.t,T.Hi,A.Cq,z.F,L.m]]}),o})()}}]);