"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[8428],{92134:(R,f,n)=>{n.d(f,{Q:()=>v});var s=n(5e3),g=n(87238),c=n(63874);let v=(()=>{class t{constructor(){this.color="warn",this.text="",this.position="after"}ngOnInit(){}}return t.\u0275fac=function(u){return new(u||t)},t.\u0275cmp=s.Xpm({type:t,selectors:[["titi-tooltip"]],inputs:{color:"color",text:"text",position:"position"},decls:4,vars:4,consts:[["matTooltipHideDelay","200",1,"tooltip-highlight",2,"margin-left","2px",3,"matTooltip","matTooltipPosition","matTooltipClass"],["tooltip","matTooltip"],[2,"font-size","18px","line-height","24px","display","inline","vertical-align","middle",3,"color"]],template:function(u,m){1&u&&(s.TgZ(0,"span",0,1),s.TgZ(2,"mat-icon",2),s._uU(3," help_outline "),s.qZA(),s.qZA()),2&u&&(s.Q6J("matTooltip",m.text)("matTooltipPosition",m.position)("matTooltipClass","titi-tooltip-text"),s.xp6(2),s.Q6J("color",m.color))},directives:[g.gM,c.Hw],styles:[""]}),t})()},38428:(R,f,n)=>{n.r(f),n.d(f,{TiusdModule:()=>j});var s=n(69808),g=n(71787),c=n(17489),v=n(28321),t=n(5e3),T=n(65707),u=n(53405),m=n(74696),U=n(11730),C=n(31657),S=n(92134),x=n(47423),D=n(11523),A=n(4834),Z=n(26688),O=n(75303);function F(o,l){if(1&o&&(t.ynx(0),t.TgZ(1,"span",17),t._uU(2),t.qZA(),t.TgZ(3,"span",18),t._uU(4),t.ALo(5,"numberFormat"),t.qZA(),t.BQk()),2&o){const e=l.$implicit,i=l.index,r=t.oxw();t.xp6(2),t.hij("",e,":"),t.xp6(2),t.hij("$ ",t.xi3(5,2,r.currentReserveRatio[i],4),"")}}function M(o,l){if(1&o&&(t.ynx(0),t.TgZ(1,"span",17),t._uU(2),t.qZA(),t.TgZ(3,"span",18),t._uU(4),t.ALo(5,"numberFormat"),t.qZA(),t.BQk()),2&o){const e=l.$implicit,i=l.index,r=t.oxw();t.xp6(2),t.hij("",e,":"),t.xp6(2),t.hij("$ ",t.xi3(5,2,r.currentRainydayFundRatio[i],4),"")}}const P=[{path:"",component:(()=>{class o{constructor(e,i,r,a,p){this.chainInfoService=e,this.graphService=i,this.echartService=r,this.web3Service=a,this.refreshService=p,this.option1={},this.option2={},this.option3={},this.option4={},this.TiUSDCirculation=0,this.TiUSDPrice=1,this.reserveRatio=100,this.totalReserve=0,this.reserveNames=[],this.currentReserveRatio=[],this.dailyReserveValue=[],this.totalRainydayFund=0,this.currentRainydayFundRatio=[],this.dailyRainydayFundValue=[]}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){Promise.all([this.fetchReserves(),this.fetchOptions()]).then(()=>{this.buildOption(),this.fetchTiUSDInfo()})}buildOption(){this.option1.series=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],type:"bar",stack:"total",label:{show:!1},emphasis:{focus:"series"},data:this.dailyReserveValue[i]})),this.option3.series=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],type:"bar",stack:"total",label:{show:!1},emphasis:{focus:"series"},data:this.dailyRainydayFundValue[i]})),this.option2.series[0].data=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],value:this.currentReserveRatio[i]})),this.option4.series[0].data=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],value:this.currentRainydayFundRatio[i]})),this.option1=(0,c.cloneDeep)(this.option1),this.option2=(0,c.cloneDeep)(this.option2),this.option3=(0,c.cloneDeep)(this.option3),this.option4=(0,c.cloneDeep)(this.option4)}fetchOptions(){return Promise.all([this.echartService.fetchOption("TiUSD-Reserve-Bar"),this.echartService.fetchOption("TiUSD-Reserve-Pie"),this.echartService.fetchOption("RainydayFund-Bar"),this.echartService.fetchOption("RainydayFund-Pie")]).then(e=>{this.option1=e[0],this.option2=e[1],this.option3=e[2],this.option4=e[3]})}fetchReserves(){return this.graphService.fetchAllSwapPairDailyData().then(({data:e})=>{const i=e.pairs;this.reserveNames=[],this.currentReserveRatio=[],this.dailyReserveValue=[],this.totalReserve=0,i.forEach(r=>{this.reserveNames.push(r.token1.symbol),this.currentReserveRatio.push(1*r.prv),this.totalReserve+=1*r.prv;const a=Array(30).fill(null),p=(0,v.Gq)().reverse();r.pairDailyData.forEach(d=>{const y=p.indexOf(1e3*d.dayStartTimestamp);-1!==y&&(a[y]=1*d.prv)});let h=0;a.forEach((d,y)=>{null===d?a[y]=h:h=d}),this.dailyReserveValue.push(a)})}).then(()=>this.fetchRainydayFund())}fetchRainydayFund(){return this.graphService.fetchVaultFund(this.chainInfoService.getChainConfig().contractAddressMap.RainyDayFundVault.toLowerCase()).then(({data:e})=>{const i=e.fundVault?e.fundVault.dailyBalance:[];this.dailyRainydayFundValue=Array(this.reserveNames.length).fill(Array(30).fill(null));const r=(0,v.Gq)().reverse();i.forEach(a=>{const p=r.indexOf(1e3*a.dayStartTimestamp),h=this.reserveNames.indexOf(a.token.symbol);-1!==p&&-1!==h&&(this.dailyRainydayFundValue[h][p]=a.balance/a.token.decimals)}),this.dailyRainydayFundValue.forEach(a=>{let p=0;a.forEach((h,d)=>{null===h?a[d]=p:p=h})}),this.totalRainydayFund=0,this.currentRainydayFundRatio=this.dailyRainydayFundValue.map(a=>(this.totalRainydayFund+=a[a.length-1],a[a.length-1]))})}fetchTiUSDInfo(){Promise.all([this.graphService.fetchTiUSDCirculation(),this.web3Service.invokeContract("MAMMSwapPair","getTiUSDPrice",[])]).then(([e,i])=>{const r=e.data.tiUSD&&e.data.tiUSD.tiusdCirculation?e.data.tiUSD.tiusdCirculation/10**18:0;this.TiUSDPrice=i[1]&&i[0]/10**18||1;const a=r>0?(100*(this.totalReserve+this.totalRainydayFund)/r).toFixed(2):100;this.reserveRatio=Number(a),this.TiUSDCirculation=r})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(T.Z),t.Y36(u.h),t.Y36(m.p),t.Y36(U.Uc),t.Y36(C.g))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-tiusd"]],decls:58,vars:28,consts:[[1,"tisud-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],["text","Current price of TiUSD in MAMM"],[1,"value"],["routerLink","/swap","mat-raised-button","","color","primary",1,"action-btn"],["text","TiUSD Circulation = TiUSD Total supply - TiUSD in MAMM"],["text","The ratio of total reserve value to total TiUSD in circulation."],[1,"mat-elevation-z4","chart-wrapper"],[2,"width","100%","height","100%",3,"option","showTitle"],[1,"pool-info-card","mat-elevation-z4"],[1,"pool-info-title"],[4,"ngFor","ngForOf"],[2,"grid-column-start","1","grid-column-end","3","display","grid","grid-template-columns","2fr 3fr 2fr","align-items","center"],[2,"justify-self","center"],[1,"pool-chart"],[2,"width","100%","height","100%",3,"option"],[2,"justify-self","start"],[2,"justify-self","end"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3,"TiUSD Price"),t._UZ(4,"titi-tooltip",3),t.qZA(),t.TgZ(5,"span",4),t._uU(6),t.ALo(7,"numberFormat"),t.qZA(),t.TgZ(8,"button",5),t._uU(9,"BUY"),t.qZA(),t.qZA(),t.TgZ(10,"div",1),t.TgZ(11,"h2",2),t._uU(12,"TiUSD Circulation"),t._UZ(13,"titi-tooltip",6),t.qZA(),t.TgZ(14,"span",4),t._uU(15),t.ALo(16,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(17,"div",1),t.TgZ(18,"h2",2),t._uU(19,"Reserve Ratio"),t._UZ(20,"titi-tooltip",7),t.qZA(),t.TgZ(21,"span",4),t._uU(22),t.ALo(23,"number"),t.qZA(),t.qZA(),t.TgZ(24,"div",8),t._UZ(25,"titi-chart-wrapper",9),t.qZA(),t.TgZ(26,"div",10),t.TgZ(27,"h2",11),t._uU(28,"Total Reserve Value"),t.qZA(),t.TgZ(29,"h3",11),t._uU(30),t.ALo(31,"numberFormat"),t.qZA(),t.YNc(32,F,6,5,"ng-container",12),t.TgZ(33,"div",13),t._UZ(34,"mat-divider"),t.TgZ(35,"mat-chip-list",14),t.TgZ(36,"mat-chip"),t._uU(37,"Assets Allocation"),t.qZA(),t.qZA(),t._UZ(38,"mat-divider"),t.qZA(),t.TgZ(39,"div",15),t._UZ(40,"titi-chart-wrapper",16),t.qZA(),t.qZA(),t.TgZ(41,"div",8),t._UZ(42,"titi-chart-wrapper",9),t.qZA(),t.TgZ(43,"div",10),t.TgZ(44,"h2",11),t._uU(45,"Rainy Day Fund"),t.qZA(),t.TgZ(46,"h3",11),t._uU(47),t.ALo(48,"numberFormat"),t.qZA(),t.YNc(49,M,6,5,"ng-container",12),t.TgZ(50,"div",13),t._UZ(51,"mat-divider"),t.TgZ(52,"mat-chip-list",14),t.TgZ(53,"mat-chip"),t._uU(54,"Assets Allocation"),t.qZA(),t.qZA(),t._UZ(55,"mat-divider"),t.qZA(),t.TgZ(56,"div",15),t._UZ(57,"titi-chart-wrapper",16),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.Oqu("$ "+t.xi3(7,13,i.TiUSDPrice,4)),t.xp6(9),t.Oqu(t.xi3(16,16,i.TiUSDCirculation,4)),t.xp6(7),t.Oqu(i.reserveRatio<100?"loading...":t.xi3(23,19,i.reserveRatio,"1.4-4")+"%"),t.xp6(3),t.Q6J("option",i.option1)("showTitle",!0),t.xp6(5),t.hij("$ ",t.xi3(31,22,i.totalReserve,4),""),t.xp6(2),t.Q6J("ngForOf",i.reserveNames),t.xp6(8),t.Q6J("option",i.option2),t.xp6(2),t.Q6J("option",i.option3)("showTitle",!0),t.xp6(5),t.hij("$ ",t.xi3(48,25,i.totalRainydayFund,4),""),t.xp6(2),t.Q6J("ngForOf",i.reserveNames),t.xp6(8),t.Q6J("option",i.option4))},directives:[S.Q,x.lW,g.rH,D.o,s.sg,A.d,Z.qn,Z.HS],pipes:[O.p,s.JJ],styles:[".tisud-wrapper[_ngcontent-%COMP%]{padding:12px 24px 24px 12px;display:grid;grid-template-columns:2fr 2fr 2fr 2fr 2fr 2fr 0fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:24px;row-gap:24px}.biz-info-card[_ngcontent-%COMP%]{min-height:80px;padding:18px;width:100%;grid-column-start:span 2;display:grid;grid-template-columns:1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 3;margin-left:48px;margin-bottom:20px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 2;margin-left:48px;align-self:end;font-size:18px;line-height:36px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 4;align-self:start;justify-self:start;width:100%;padding:12px 18px;height:100%}.pool-info-card[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:start;justify-self:start;width:100%;height:100%;padding:12px 18px;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:40px 40px 40px auto;grid-row-gap:12px;row-gap:12px;align-items:center}.pool-info-title[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3;height:40px;font-size:20px;justify-self:center;align-self:start}.pool-chart[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3;justify-self:center;width:100%;height:100%}@media screen and (max-width: 1024px){.tisud-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr;width:100%;padding:12px;grid-row-gap:12px;row-gap:12px}.biz-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px 48px}.chart-wrapper[_ngcontent-%COMP%], .pool-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px 48px;height:auto}}"]}),o})()}];let w=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[g.Bz.forChild(P)],g.Bz]}),o})();var N=n(45922),q=n(87841);let j=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[s.ez,w,A.t,Z.Hi,N.F,q.m,x.ot]]}),o})()}}]);